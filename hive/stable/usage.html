<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Usage :: Stackable Documentation</title>
    <link rel="canonical" href="https://docs.stackable.tech/hive/stable/usage.html">
    <meta name="generator" content="Antora 3.1.0">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
    <link rel="icon" href="../../_/img/favicon.png" type="image/png">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://stackable.tech"><img src="../../_/img/stackable-logo.png"></a>
      <a class="navbar-item documentation-link" href="https://docs.stackable.tech">Documentation</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search...">
        </div>
      </div>
      <button class="navbar-burger" data-target="navbar-sub">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <a href="https://www.stackable.tech/contact/" class="button pull-right">Contact Us</a>
    </div>
      <div id="topbar-nav" class="navbar-menu">
      </div>
      </div>
    </nav>
    <nav id="navbar-sub" class="navbar-sub">
      <div class="container">
        <a class="navbar-sub-item" href="../../home/stable/index.html">Home</a>
<a class="navbar-sub-item" href="../../home/stable/getting_started.html">Getting Started</a>
<a class="navbar-sub-item" href="../../home/stable/concepts/index.html">Concepts</a>
<a class="navbar-sub-item" href="../../home/stable/tutorials/end-to-end_data_pipeline_example.html">Tutorials</a>
<a class="navbar-sub-item" href="../../stackablectl/stable/index.html">stackablectl</a>
<div class="navbar-sub-item drop-down">
    Operators
    <div class="drop-down-content">
        <a class="drop-down-item" href="../../home/stable/operators/index.html">Overview</a>
        <a class="drop-down-item" href="../../airflow/stable/index.html">Apache Airflow</a>
        <a class="drop-down-item" href="../../druid/stable/index.html">Apache Druid</a>
        <a class="drop-down-item" href="../../hbase/stable/index.html">Apache HBase</a>
        <a class="drop-down-item" href="../../hdfs/stable/index.html">Apache Hadoop HDFS</a>
        <a class="drop-down-item" href="index.html">Apache Hive</a>
        <a class="drop-down-item" href="../../kafka/stable/index.html">Apache Kafka</a>
        <a class="drop-down-item" href="../../nifi/stable/index.html">Apache NiFi</a>
        <a class="drop-down-item" href="../../spark-k8s/stable/index.html">Apache Spark on K8S</a>
        <a class="drop-down-item" href="../../superset/stable/index.html">Apache Superset</a>
        <a class="drop-down-item" href="../../trino/stable/index.html">Trino</a>
        <a class="drop-down-item" href="../../zookeeper/stable/index.html">Apache ZooKeeper</a>
        <a class="drop-down-item" href="../../opa/stable/index.html">OpenPolicyAgent</a>
        <a class="drop-down-item" href="../../commons-operator/stable/index.html">Commons</a>
        <a class="drop-down-item" href="../../secret-operator/stable/index.html">Secret</a>
        <a class="drop-down-item" href="../../listener-operator/stable/index.html">Listener</a>
    </div>
</div>
<a class="navbar-sub-item" href="../../home/stable/contributor/index.html">Contribute</a>

        <a class="arrow" href="javascript:document.querySelector('.navbar-sub').classList.toggle('open')">
          <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"></path></svg>
        </a>
      </div>
    </nav>
  </header>
<div class="body">
    <div class="container">
<div class="nav-container" data-component="hive" data-version="0.8">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <div class="title-wrapper">
      <h3 class="title"><a href="index.html">Stackable Operator for Apache Hive</a></h3>
      <div class="page-versions">
        <button class="version-menu-toggle" title="Show other versions of page">0.8</button>
        <div class="version-menu">
          <a class="version" href="../nightly/usage.html">nightly</a>
          <a class="version is-current" href="usage.html">0.8</a>
          <a class="version" href="../0.7/usage.html">0.7</a>
          <a class="version" href="../0.6/usage.html">0.6</a>
        </div>
      </div>
    </div>
    <ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="getting_started/index.html">Getting started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="getting_started/installation.html">Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="getting_started/first_steps.html">First steps</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="configuration.html">Configuration</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="usage.html">Usage</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Concepts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="discovery.html">Discovery</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Stackable Operator for Apache Hive</span>
    <span class="version">0.8</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../commons-operator/stable/index.html">Stackable Commons Operator</a>
      <ul class="versions">
        <li class="version">
          <a href="../../commons-operator/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../commons-operator/stable/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../commons-operator/0.3/index.html">0.3</a>
        </li>
        <li class="version">
          <a href="../../commons-operator/0.2/index.html">0.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../home/stable/index.html">Stackable Documentation</a>
      <ul class="versions">
        <li class="version">
          <a href="../../home/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../home/stable/index.html">22.11</a>
        </li>
        <li class="version">
          <a href="../../home/22.09/index.html">22.09</a>
        </li>
        <li class="version">
          <a href="../../home/22.06/index.html">22.06</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../listener-operator/stable/index.html">Stackable Listener Operator</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../listener-operator/stable/index.html">nightly</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../airflow/stable/index.html">Stackable Operator for Apache Airflow</a>
      <ul class="versions">
        <li class="version">
          <a href="../../airflow/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../airflow/stable/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../airflow/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../airflow/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../airflow/0.3/index.html">0.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../druid/stable/index.html">Stackable Operator for Apache Druid</a>
      <ul class="versions">
        <li class="version">
          <a href="../../druid/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../druid/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../druid/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../druid/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../druid/0.2/index.html">0.2</a>
        </li>
        <li class="version">
          <a href="../../druid/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../hbase/stable/index.html">Stackable Operator for Apache HBase</a>
      <ul class="versions">
        <li class="version">
          <a href="../../hbase/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../hbase/stable/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../hbase/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../hbase/0.3/index.html">0.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../hdfs/stable/index.html">Stackable Operator for Apache HDFS</a>
      <ul class="versions">
        <li class="version">
          <a href="../../hdfs/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../hdfs/stable/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../hdfs/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../hdfs/0.4/index.html">0.4</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">Stackable Operator for Apache Hive</a>
      <ul class="versions">
        <li class="version">
          <a href="../nightly/index.html">nightly</a>
        </li>
        <li class="version is-current is-latest">
          <a href="index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../0.6/index.html">0.6</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../kafka/stable/index.html">Stackable Operator for Apache Kafka</a>
      <ul class="versions">
        <li class="version">
          <a href="../../kafka/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../kafka/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../kafka/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../kafka/0.6/index.html">0.6</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../nifi/stable/index.html">Stackable Operator for Apache NiFi</a>
      <ul class="versions">
        <li class="version">
          <a href="../../nifi/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../nifi/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../nifi/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../nifi/0.6/index.html">0.6</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../spark-k8s/stable/index.html">Stackable Operator for Apache Spark on Kubernetes</a>
      <ul class="versions">
        <li class="version">
          <a href="../../spark-k8s/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../spark-k8s/stable/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../spark-k8s/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../spark-k8s/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../spark-k8s/0.3/index.html">0.3</a>
        </li>
        <li class="version">
          <a href="../../spark-k8s/0.2/index.html">0.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../superset/stable/index.html">Stackable Operator for Apache Superset</a>
      <ul class="versions">
        <li class="version">
          <a href="../../superset/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../superset/stable/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../superset/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../superset/0.5/index.html">0.5</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../zookeeper/stable/index.html">Stackable Operator for Apache ZooKeeper</a>
      <ul class="versions">
        <li class="version">
          <a href="../../zookeeper/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../zookeeper/stable/index.html">0.12</a>
        </li>
        <li class="version">
          <a href="../../zookeeper/0.11/index.html">0.11</a>
        </li>
        <li class="version">
          <a href="../../zookeeper/0.10/index.html">0.10</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../opa/stable/index.html">Stackable Operator for OPA</a>
      <ul class="versions">
        <li class="version">
          <a href="../../opa/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../opa/stable/index.html">0.11</a>
        </li>
        <li class="version">
          <a href="../../opa/0.10/index.html">0.10</a>
        </li>
        <li class="version">
          <a href="../../opa/0.9/index.html">0.9</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../trino/stable/index.html">Stackable Operator for Trino</a>
      <ul class="versions">
        <li class="version">
          <a href="../../trino/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../trino/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../trino/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../trino/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../trino/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../trino/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../trino/0.3/index.html">0.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../secret-operator/stable/index.html">Stackable Secret Operator</a>
      <ul class="versions">
        <li class="version">
          <a href="../../secret-operator/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../secret-operator/stable/index.html">0.5</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../stackablectl/stable/index.html">stackablectl</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../stackablectl/stable/index.html">nightly</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../home/stable/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Stackable Operator for Apache Hive</a></li>
    <li><a href="usage.html">Usage</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/stackabletech/hive-operator/blob/docs/0.8/docs/modules/ROOT/pages/usage.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Usage</h1>
<div class="sect1">
<h2 id="_requirements"><a class="anchor" href="#_requirements"></a>Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache Hive Metastores need a relational database to store their state.
We currently support <a href="https://www.postgresql.org/">PostgreSQL</a> and <a href="https://db.apache.org/derby/">Apache Derby</a> (embedded database, not recommended for production).
Other databases might work if JDBC drivers are available.
Please open an <a href="https://github.com/stackabletech/hive-operator/issues">issue</a> if you require support for another database.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_s3_support"><a class="anchor" href="#_s3_support"></a>S3 Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hive supports creating tables in S3 compatible object stores.
To use this feature you need to provide connection details for the object store using the <a href="../../home/stable/concepts/s3.html" class="xref page">S3Connection</a>.</p>
</div>
<div class="paragraph">
<p>An example usage can look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  s3:
    inline:
      host: minio
      port: 9000
      accessStyle: Path
      credentials:
        secretClass: simple-hive-s3-secret-class</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_apache_hdfs_support"><a class="anchor" href="#_apache_hdfs_support"></a>Apache HDFS Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As well as S3, Hive also supports creating tables in HDFS.
You can add the HDFS connection as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  hdfs:
    configMap: my-hdfs-cluster # Name of the HdfsCluster</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring"><a class="anchor" href="#_monitoring"></a>Monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The managed Hive instances are automatically configured to export Prometheus metrics. See
<a href="../../home/stable/operators/monitoring.html" class="xref page">Monitoring</a> for more details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_environment_overrides"><a class="anchor" href="#_configuration_environment_overrides"></a>Configuration &amp; Environment Overrides</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The cluster definition also supports overriding configuration properties and environment variables, either per role or per role group, where the more specific override (role group) has precedence over the less specific one (role).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Overriding certain properties, which are set by the operator (such as the HTTP port) can interfere with the operator and can lead to problems.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_configuration_properties"><a class="anchor" href="#_configuration_properties"></a>Configuration Properties</h3>
<div class="paragraph">
<p>For a role or role group, at the same level of <code>config</code>, you can specify: <code>configOverrides</code> for the <code>hive-site.xml</code>. For example, if you want to set the <code>datanucleus.connectionPool.maxPoolSize</code> for the metastore to 20 adapt the <code>metastore</code> section of the cluster resource like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">metastore:
  roleGroups:
    default:
      config: [...]
      configOverrides:
        hive-site.xml:
          datanucleus.connectionPool.maxPoolSize: "20"
      replicas: 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just as for the <code>config</code>, it is possible to specify this at role level as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">metastore:
  configOverrides:
    hive-site.xml:
      datanucleus.connectionPool.maxPoolSize: "20"
  roleGroups:
    default:
      config: [...]
      replicas: 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>All override property values must be strings. The properties will be formatted and escaped correctly into the XML file.</p>
</div>
<div class="paragraph">
<p>For a full list of configuration options we refer to the Hive <a href="https://cwiki.apache.org/confluence/display/hive/configuration+properties">Configuration Reference</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_environment_variables"><a class="anchor" href="#_environment_variables"></a>Environment Variables</h3>
<div class="paragraph">
<p>In a similar fashion, environment variables can be (over)written. For example per role group:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">metastore:
  roleGroups:
    default:
      config: {}
      envOverrides:
        MY_ENV_VAR: "MY_VALUE"
      replicas: 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>or per role:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">metastore:
  envOverrides:
    MY_ENV_VAR: "MY_VALUE"
  roleGroups:
    default:
      config: {}
      replicas: 1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_storage_for_data_volumes"><a class="anchor" href="#_storage_for_data_volumes"></a>Storage for data volumes</h3>
<div class="paragraph">
<p>You can mount a volume where the Hive Metastore data is stored by specifying <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes">PersistentVolumeClaims</a> for each individual role or role group:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">metastore:
  config:
    resources:
      storage:
        data:
          capacity: 2Gi
  roleGroups:
    default:
      config:
        resources:
          storage:
            data:
              capacity: 3Gi</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, all Hive Metastores in the default group will store data on a <code>3Gi</code> volume. Additional role groups not specifying any resources will inherit the config provided on the role level (<code>2Gi</code> volume). This works the same for memory or CPU requests.</p>
</div>
<div class="paragraph">
<p>By default, in case nothing is configured in the custom resource for a certain role group, each Pod will have a <code>2Gi</code> large local volume mount for the data location containing mainly logs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resource_requests"><a class="anchor" href="#_resource_requests"></a>Resource Requests</h3>
<div class="paragraph">
<p>Stackable operators handle resource requests in a sligtly different manner than Kubernetes. Resource requests are defined on role or group level. See <a href="../../home/stable/concepts/roles-and-role-groups.html" class="xref page">Roles and role groups</a> for details on these concepts. On a role level this means that e.g. all workers will use the same resource requests and limits. This can be further specified on role group level (which takes priority to the role level) to apply different resources.</p>
</div>
<div class="paragraph">
<p>This is an example on how to specify CPU and memory resources using the Stackable <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">Custom Resources</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">---
apiVersion: example.stackable.tech/v1alpha1
kind: ExampleCluster
metadata:
  name: example
spec:
  workers: # role-level
    config:
      resources:
        cpu:
          min: 300m
          max: 600m
        memory:
          limit: 3Gi
    roleGroups: # role-group-level
      resources-from-role: # role-group 1
        replicas: 1
      resources-from-role-group: # role-group 2
        replicas: 1
        config:
          resources:
            cpu:
              min: 400m
              max: 800m
            memory:
              limit: 4Gi</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the role group <code>resources-from-role</code> will inherit the resources specified on the role level. Resulting in a maximum of <code>3Gi</code> memory and <code>600m</code> CPU resources.</p>
</div>
<div class="paragraph">
<p>The role group <code>resources-from-role-group</code> has maximum of <code>4Gi</code> memory and <code>800m</code> CPU resources (which overrides the role CPU resources).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
For Java products the actual used Heap memory is lower than the specified memory limit due to other processes in the Container requiring memory to run as well. Currently, 80% of the specified memory limits is passed to the JVM.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For memory only a limit can be specified, which will be set as memory request and limit in the Container. This is to always guarantee a Container the full amount memory during Kubernetes scheduling.</p>
</div>
<div class="paragraph">
<p>If no resource requests are configured explicitly, the Hive operator uses the following defaults:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">metastore:
  roleGroups:
    default:
      config:
        resources:
          requests:
            cpu: 200m
            memory: 2Gi
          limits:
            cpu: "4"
            memory: 2Gi
          storage:
            data:
              capacity: 2Gi</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The default values are <em>most likely</em> not sufficient to run a proper cluster in production. Please adapt according to your requirements.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more details regarding Kubernetes CPU limits see: <a href="https://kubernetes.io/docs/tasks/configure-pod-container/assign-cpu-resource/">Assign CPU Resources to Containers and Pods</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examples"><a class="anchor" href="#_examples"></a>Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Please note that the version you need to specify is not only the version of Apache Hive which you want to roll out, but has to be amended with a Stackable version as shown.
This Stackable version is the version of the underlying container image which is used to execute the processes.
For a list of available versions please check our <a href="https://repo.stackable.tech/#browse/browse:docker:v2%2Fstackable%2Fhive%2Ftags">image registry</a>.
It should generally be safe to simply use the latest image version that is available.</p>
</div>
<div class="listingblock">
<div class="title">Create a single node Apache Hive Metastore cluster using Derby:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">---
apiVersion: hive.stackable.tech/v1alpha1
kind: HiveCluster
metadata:
  name: simple-hive-derby
spec:
  version: 3.1.3-stackable0.1.0
  metastore:
    roleGroups:
      default:
        selector:
          matchLabels:
            kubernetes.io/os: linux
        replicas: 1
        config:
          database:
            connString: jdbc:derby:;databaseName=/tmp/metastore_db;create=true
            user: APP
            password: mine
            dbType: derby</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create a single node Apache Hive Metastore (v2.3.9) cluster with derby and S3 access, deploy a minio (or use any available S3 bucket):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">helm install minio \
    minio \
    --repo https://charts.bitnami.com/bitnami \
    --set auth.rootUser=minio-access-key \
    --set auth.rootPassword=minio-secret-key</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to upload data to minio we need a port-forward to access the web ui.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl port-forward service/minio 9001</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, connect to localhost:9001 and login with the user <code>minio-access-key</code> and password <code>minio-secret-key</code>. Create a bucket and upload data.</p>
</div>
<div class="paragraph">
<p>Deploy the hive cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">---
apiVersion: hive.stackable.tech/v1alpha1
kind: HiveCluster
metadata:
  name: simple-hive-derby
spec:
  version: 3.1.3-stackable0.1.0
  s3:
    inline:
      host: minio
      port: 9000
      accessStyle: Path
      credentials:
        secretClass: simple-hive-s3-secret-class
  metastore:
    roleGroups:
      default:
        selector:
          matchLabels:
            kubernetes.io/os: linux
        replicas: 1
        config:
          database:
            connString: jdbc:derby:;databaseName=/stackable/metastore_db;create=true
            user: APP
            password: mine
            dbType: derby
---
apiVersion: secrets.stackable.tech/v1alpha1
kind: SecretClass
metadata:
  name: simple-hive-s3-secret-class
spec:
  backend:
    k8sSearch:
      searchNamespace:
        pod: {}
---
apiVersion: v1
kind: Secret
metadata:
  name: simple-hive-s3-secret
  labels:
    secrets.stackable.tech/class: simple-hive-s3-secret-class
stringData:
  accessKey: minio-access-key
  secretKey: minio-secret-key</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create a single node Apache Hive Metastore using PostgreSQL, deploy a PostgreSQL instance via helm.</p>
</div>
<div class="sidebarblock">
<div class="content">
PostgreSQL introduced a new way to encrypt its passwords in version 10.
This is called <code>scram-sha-256</code> and has been the default as of PostgreSQL 14.
Unfortunately, Hive up until the latest 3.3.x version ships with JDBC drivers that do <a href="https://wiki.postgresql.org/wiki/List_of_drivers"><em>not</em> support</a> this method.
You might see an error message like this:
<code>The authentication type 10 is not supported.</code>
If this is the case please either use an older PostgreSQL version or change its <a href="https://www.postgresql.org/docs/current/runtime-config-connection.html#GUC-PASSWORD-ENCRYPTION"><code>password_encryption</code></a> setting to <code>md5</code>.
</div>
</div>
<div class="paragraph">
<p>This installs PostgreSQL in version 10 to work around the issue mentioned above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">helm install hive bitnami/postgresql --version=10 \
--set postgresqlUsername=hive \
--set postgresqlPassword=hive \
--set postgresqlDatabase=hive</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Create Hive Metastore using a PostgreSQL database</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: hive.stackable.tech/v1alpha1
kind: HiveCluster
metadata:
  name: simple-hive-postgres
spec:
  version: 3.1.3-stackable0.1.0
  metastore:
    roleGroups:
      default:
        selector:
          matchLabels:
            kubernetes.io/os: linux
        replicas: 1
        config:
          database:
            connString: jdbc:postgresql://hive-postgresql.default.svc.cluster.local:5432/hive
            user: hive
            password: hive
            dbType: postgres</code></pre>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
    </div>
</div>
<footer class="footer">
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
