<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nifi-kafka-druid-earthquake-data :: Stackable Documentation</title>
    <meta name="generator" content="Antora 3.1.0">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
    <link rel="icon" href="../../../_/img/favicon.png" type="image/png">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://stackable.tech"><img src="../../../_/img/stackable-logo.png"></a>
      <a class="navbar-item documentation-link" href="https://docs.stackable.tech">Documentation</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search...">
        </div>
      </div>
      <button class="navbar-burger" data-target="navbar-sub">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <a href="https://www.stackable.tech/contact/" class="button pull-right">Contact Us</a>
    </div>
      <div id="topbar-nav" class="navbar-menu">
      </div>
      </div>
    </nav>
    <nav id="navbar-sub" class="navbar-sub">
      <div class="container">
        <a class="navbar-sub-item" href="../../../home/stable/index.html">Home</a>
<a class="navbar-sub-item" href="../../../home/stable/getting_started.html">Getting Started</a>
<a class="navbar-sub-item" href="../../../home/stable/concepts/index.html">Concepts</a>
<a class="navbar-sub-item" href="../../../home/stable/tutorials/end-to-end_data_pipeline_example.html">Tutorials</a>
<a class="navbar-sub-item" href="../index.html">stackablectl</a>
<div class="navbar-sub-item drop-down">
    Operators
    <div class="drop-down-content">
        <a class="drop-down-item" href="../../../home/stable/operators/index.html">Overview</a>
        <a class="drop-down-item" href="../../../airflow/stable/index.html">Apache Airflow</a>
        <a class="drop-down-item" href="../../../druid/stable/index.html">Apache Druid</a>
        <a class="drop-down-item" href="../../../hbase/stable/index.html">Apache HBase</a>
        <a class="drop-down-item" href="../../../hdfs/stable/index.html">Apache Hadoop HDFS</a>
        <a class="drop-down-item" href="../../../hive/stable/index.html">Apache Hive</a>
        <a class="drop-down-item" href="../../../kafka/stable/index.html">Apache Kafka</a>
        <a class="drop-down-item" href="../../../nifi/stable/index.html">Apache NiFi</a>
        <a class="drop-down-item" href="../../../spark-k8s/stable/index.html">Apache Spark on K8S</a>
        <a class="drop-down-item" href="../../../superset/stable/index.html">Apache Superset</a>
        <a class="drop-down-item" href="../../../trino/stable/index.html">Trino</a>
        <a class="drop-down-item" href="../../../zookeeper/stable/index.html">Apache ZooKeeper</a>
        <a class="drop-down-item" href="../../../opa/stable/index.html">OpenPolicyAgent</a>
        <a class="drop-down-item" href="../../../commons-operator/stable/index.html">Commons</a>
        <a class="drop-down-item" href="../../../secret-operator/stable/index.html">Secret</a>
        <a class="drop-down-item" href="../../../listener-operator/stable/index.html">Listener</a>
    </div>
</div>
<a class="navbar-sub-item" href="../../../home/stable/contributor/index.html">Contribute</a>

        <a class="arrow" href="javascript:document.querySelector('.navbar-sub').classList.toggle('open')">
          <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"></path></svg>
        </a>
      </div>
    </nav>
  </header>
<div class="body">
    <div class="container">
<div class="nav-container" data-component="stackablectl" data-version="nightly">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <div class="title-wrapper">
      <h3 class="title"><a href="../index.html">stackablectl</a></h3>
    </div>
    <ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../installation.html">Installation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../quickstart.html">Quickstart</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Commands</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../commands/demo.html">Demo</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../commands/operator.html">Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../commands/release.html">Release</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../commands/services.html">Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../commands/stack.html">Stack</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Demos</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="airflow-scheduled-job.html">airflow-scheduled-job</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="data-warehouse-iceberg-trino-spark.html">data-warehouse-iceberg-trino-spark</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="hbase-hdfs-load-cycling-data.html">hbase-hdfs-cycling-data</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="nifi-kafka-druid-earthquake-data.html">nifi-kafka-druid-earthquake-data</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="nifi-kafka-druid-water-level-data.html">nifi-kafka-druid-water-level-data</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="trino-taxi-data.html">trino-taxi-data</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../customization.html">Customization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../troubleshooting.html">Troubleshooting</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">stackablectl</span>
    <span class="version">nightly</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../commons-operator/stable/index.html">Stackable Commons Operator</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../commons-operator/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../commons-operator/stable/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../../commons-operator/0.3/index.html">0.3</a>
        </li>
        <li class="version">
          <a href="../../../commons-operator/0.2/index.html">0.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../home/stable/index.html">Stackable Documentation</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../home/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../home/stable/index.html">22.11</a>
        </li>
        <li class="version">
          <a href="../../../home/22.09/index.html">22.09</a>
        </li>
        <li class="version">
          <a href="../../../home/22.06/index.html">22.06</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../listener-operator/stable/index.html">Stackable Listener Operator</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../listener-operator/stable/index.html">nightly</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../airflow/stable/index.html">Stackable Operator for Apache Airflow</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../airflow/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../airflow/stable/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../../airflow/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../../airflow/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../../airflow/0.3/index.html">0.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../druid/stable/index.html">Stackable Operator for Apache Druid</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../druid/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../druid/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../../druid/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../../druid/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../../druid/0.2/index.html">0.2</a>
        </li>
        <li class="version">
          <a href="../../../druid/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../hbase/stable/index.html">Stackable Operator for Apache HBase</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../hbase/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../hbase/stable/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../../hbase/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../../hbase/0.3/index.html">0.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../hdfs/stable/index.html">Stackable Operator for Apache HDFS</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../hdfs/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../hdfs/stable/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../../hdfs/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../../hdfs/0.4/index.html">0.4</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../hive/stable/index.html">Stackable Operator for Apache Hive</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../hive/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../hive/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../../hive/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../../hive/0.6/index.html">0.6</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../kafka/stable/index.html">Stackable Operator for Apache Kafka</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../kafka/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../kafka/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../../kafka/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../../kafka/0.6/index.html">0.6</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../nifi/stable/index.html">Stackable Operator for Apache NiFi</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../nifi/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../nifi/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../../nifi/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../../nifi/0.6/index.html">0.6</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../spark-k8s/stable/index.html">Stackable Operator for Apache Spark on Kubernetes</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../spark-k8s/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../spark-k8s/stable/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../../spark-k8s/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../../spark-k8s/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../../spark-k8s/0.3/index.html">0.3</a>
        </li>
        <li class="version">
          <a href="../../../spark-k8s/0.2/index.html">0.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../superset/stable/index.html">Stackable Operator for Apache Superset</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../superset/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../superset/stable/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../../superset/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../../superset/0.5/index.html">0.5</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../zookeeper/stable/index.html">Stackable Operator for Apache ZooKeeper</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../zookeeper/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../zookeeper/stable/index.html">0.12</a>
        </li>
        <li class="version">
          <a href="../../../zookeeper/0.11/index.html">0.11</a>
        </li>
        <li class="version">
          <a href="../../../zookeeper/0.10/index.html">0.10</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../opa/stable/index.html">Stackable Operator for OPA</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../opa/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../opa/stable/index.html">0.11</a>
        </li>
        <li class="version">
          <a href="../../../opa/0.10/index.html">0.10</a>
        </li>
        <li class="version">
          <a href="../../../opa/0.9/index.html">0.9</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../trino/stable/index.html">Stackable Operator for Trino</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../trino/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../trino/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../../trino/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../../trino/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../../trino/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../../trino/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../../trino/0.3/index.html">0.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../secret-operator/stable/index.html">Stackable Secret Operator</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../secret-operator/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../secret-operator/stable/index.html">0.5</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">stackablectl</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">nightly</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../home/stable/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">stackablectl</a></li>
    <li><a href="index.html">Demos</a></li>
    <li><a href="nifi-kafka-druid-earthquake-data.html">nifi-kafka-druid-earthquake-data</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/stackabletech/stackablectl/edit/main/docs/modules/ROOT/pages/demos/nifi-kafka-druid-earthquake-data.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">nifi-kafka-druid-earthquake-data</h1>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This guide assumes that you already have the demo <code>nifi-kafka-druid-earthquake-data</code> installed.
If you don&#8217;t have it installed please follow the <a href="../commands/demo.html#_install_demo" class="xref page">documentation on how to install a demo</a>.
To put it simply you have to run <code>stackablectl demo install nifi-kafka-druid-earthquake-data</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This demo will</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install the required Stackable operators</p>
</li>
<li>
<p>Spin up the follow data products</p>
<div class="ulist">
<ul>
<li>
<p><strong>Superset</strong>: A modern data exploration and visualization platform. This demo utilizes Superset to retrieve data from Druid via SQL queries and build dashboards on top of that data</p>
</li>
<li>
<p><strong>Kafka</strong>:  A distributed event streaming platform for high-performance data pipelines, streaming analytics and data integration. This demos uses it as an event streaming platform to stream the data in near real-time</p>
</li>
<li>
<p><strong>NiFi</strong>:  An easy-to-use, powerful system to process and distribute data. This demos uses it to fetch earthquake-data from the internet and ingest it into Kafka</p>
</li>
<li>
<p><strong>Druid</strong>: A real-time database to power modern analytics applications. This demo uses it to ingest the near real-time data from Kafka, store it and enable to access the data via SQL</p>
</li>
<li>
<p><strong>MinIO</strong>: A S3 compatible object store. This demo uses it as persistent storage for Druid to store all the data used</p>
</li>
</ul>
</div>
</li>
<li>
<p>Continuously emit approximately 10,000 records/s of <a href="https://earthquake.usgs.gov/">earthquake data</a> into Kafka</p>
</li>
<li>
<p>Start a Druid ingestion job that ingests the data into the Druid instance</p>
</li>
<li>
<p>Create Superset dashboards for visualization of the data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The whole data pipeline will have a very low latency from putting a record into Kafka to it showing up in the dashboard charts.</p>
</div>
<div class="paragraph">
<p>You can see the deployed products as well as their relationship in the following diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/overview.png" alt="overview">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_list_deployed_stackable_services"><a class="anchor" href="#_list_deployed_stackable_services"></a>List deployed Stackable services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To list the installed Stackable services run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ stackablectl services list --all-namespaces
 PRODUCT    NAME         NAMESPACE  ENDPOINTS                                    EXTRA INFOS

 druid      druid        default    broker-http        http://172.18.0.3:32670
                                    coordinator-http   http://172.18.0.3:30392
                                    historical-http    http://172.18.0.2:30831
                                    middlemanager-http http://172.18.0.4:30356
                                    router-http        http://172.18.0.4:30109

 kafka      kafka        default    kafka              172.18.0.4:30968

 nifi       nifi         default    https              https://172.18.0.3:32558  Admin user: admin, password: adminadmin

 superset   superset     default    external-superset  http://172.18.0.3:32108   Admin user: admin, password: admin

 zookeeper  zookeeper    default    zk                 172.18.0.2:32309

 minio      minio-druid  default    http               http://172.18.0.4:32306   Third party service
                                    console-http       http://172.18.0.4:31664   Admin user: root, password: rootroot</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When a product instance has not finished starting yet, the service will have no endpoint.
Starting all the product instances might take a considerable amount of time depending on your internet connectivity.
In case the product is not ready yet a warning might be shown.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_inspect_data_in_kafka"><a class="anchor" href="#_inspect_data_in_kafka"></a>Inspect data in Kafka</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kafka is used as an event streaming platform to stream the data in near real-time.
All the messages put in and read from Kafka are structured in dedicated queues called topics.
The test data will be put in a topic called <code>earthquakes</code>.
The records get produced (put in) by the test data generator and are consumed (read) by Druid afterwards in the same order they where produced.</p>
</div>
<div class="paragraph">
<p>As Kafka itself has no webinterface you have to use a Kafka client like <a href="https://github.com/edenhill/kcat">kafkacat</a>.
In order to connect to Kafka, use the <code>kafka</code> endpoint from the <code>kafka</code> service in your <code>stackablectl services list</code> command output (<code>172.18.0.4:30968</code> in this case).</p>
</div>
<div class="paragraph">
<p>If you have <code>kafkacat</code> installed, you can see the available brokers and topics with the following command.
You need to replace the <code>-b</code> parameter to match your Kafka endpoint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kafkacat -b 172.18.0.4:30968 -L
Metadata for all topics (from broker -1: 172.18.0.4:30968/bootstrap):
 1 brokers:
  broker 1001 at 172.18.0.4:30755 (controller)
 1 topics:
  topic "earthquakes" with 1 partitions:
    partition 0, leader 1001, replicas: 1001, isrs: 1001</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see that Kafka consists of one broker and the topic <code>earthquakes</code> has been created.
To see some records that have been send to Kafka run the following command.
You can change the number of records to print via the <code>-c</code> parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kafkacat -b 172.18.0.4:30968 -C -t earthquakes -c 3
{"time":"1950-01-02T15:14:37.960Z","latitude":-11.242,"longitude":165.006,"depth":15.0,"mag":6.12,"magType":"mw","nst":null,"gap":null,"dmin":null,"rms":null,"net":"iscgem","id":"iscgem895104","updated":"2022-04-26T18:23:01.545Z","place":"103 km WSW of Lata, Solomon Islands","type":"earthquake","horizontalError":null,"depthError":8.6,"magError":0.41,"magNst":null,"status":"reviewed","locationSource":"iscgem","magSource":"iscgem"}
{"time":"1950-01-03T02:51:55.410Z","latitude":17.533,"longitude":121.447,"depth":30.0,"mag":6.5,"magType":"mw","nst":null,"gap":null,"dmin":null,"rms":null,"net":"iscgem","id":"iscgem895106","updated":"2022-04-26T18:23:07.394Z","place":"6 km NNW of Tabuk, Philippines","type":"earthquake","horizontalError":null,"depthError":3.8,"magError":0.34,"magNst":null,"status":"reviewed","locationSource":"iscgem","magSource":"iscgem"}
{"time":"1950-01-03T11:06:28.640Z","latitude":-45.798,"longitude":-77.077,"depth":15.0,"mag":6.27,"magType":"mw","nst":null,"gap":null,"dmin":null,"rms":null,"net":"iscgem","id":"iscgem895109","updated":"2022-04-26T18:23:08.483Z","place":"Off the coast of Aisen, Chile","type":"earthquake","horizontalError":null,"depthError":25.0,"magError":0.2,"magNst":null,"status":"reviewed","locationSource":"iscgem","magSource":"iscgem"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are interested on how many records have been produced to the Kafka topic so far, use the following command.
It will print the last record produced to the topic, which will be formatted with the pattern specified in the <code>-f</code> parameter.
The given pattern will print some metadata of the record.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kafkacat -b 172.18.0.4:30968 -C -t earthquakes -o -1 -c 1 \
    -f 'Topic %t / Partition %p / Offset: %o / Timestamp: %T\n'
Topic earthquakes / Partition 0 / Offset: 2670281 / Timestamp: 1660571644060</code></pre>
</div>
</div>
<div class="paragraph">
<p>From the output you can see, that the last record was produced at the timestamp <code>1660571644060</code> which translates to <code>Mo 15. Aug 15:54:04 CEST 2022</code> (using the command <code>date -d @1660571644</code>).
You can also see that it was the record number <code>2670281</code> send to this topic, so ~2.6 million records have been produced so far.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_nifi"><a class="anchor" href="#_nifi"></a>NiFi</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NiFi is used to fetch earthquake-data from the internet and ingest it into Kafka.
This demo includes a workflow ("process group") that downloads a large CSV file, converts it to individual JSON records and produces the records into Kafka.</p>
</div>
<div class="sect2">
<h3 id="_view_testdata_generation_job"><a class="anchor" href="#_view_testdata_generation_job"></a>View testdata-generation job</h3>
<div class="paragraph">
<p>You can have a look at the ingestion job running in NiFi by opening the given <code>nifi</code> endpoint <code>https</code> from your <code>stackablectl services list</code> command output.
You have to use the endpoint from your command output, in this case it is <a href="https://172.18.0.3:32558" class="bare">https://172.18.0.3:32558</a>. Open it with your favorite browser.
If you get a warning regarding the self-signed certificate generated by the <a href="../../../secret-operator/stable/index.html" class="xref page">Secret Operator</a> (e.g. <code>Warning: Potential Security Risk Ahead</code>), you have to tell your browser to trust the website and continue.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/nifi_1.png" alt="nifi 1">
</div>
</div>
<div class="paragraph">
<p>Log in with the username <code>admin</code> and password <code>adminadmin</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/nifi_2.png" alt="nifi 2">
</div>
</div>
<div class="paragraph">
<p>You can see the started ProcessGroup consisting of two processors.
The first one - <code>InvokeHTTP</code> fetches the CSV file from the Internet and put&#8217;s it into the queue to the next processor.
The second processor - <code>PublishKafkaRecord_2_6</code> parses the CSV file, converts it to JSON records and writes them out into Kafka.</p>
</div>
<div class="paragraph">
<p>Double-click on the <code>InvokeHTTP</code> processor to show the processor details.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/nifi_3.png" alt="nifi 3">
</div>
</div>
<div class="paragraph">
<p>Head over to the Tab <code>PROPERTIES</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/nifi_4.png" alt="nifi 4">
</div>
</div>
<div class="paragraph">
<p>Here you can see the setting <code>Remote URl</code>, which specifies the download URL from where the CSV file is retrieved.</p>
</div>
<div class="paragraph">
<p>Close the processor details popup by clicking <code>OK</code>.
Afterwards double-click on the processor <code>PublishKafkaRecord_2_6</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/nifi_5.png" alt="nifi 5">
</div>
</div>
<div class="paragraph">
<p>Within this processor the Kafka connection details - like broker addresses and topic name - are specified.
It uses the <code>CSVReader</code> to parse the downloaded CSV and the <code>JsonRecordSetWriter</code> to split it into individual JSON records before writing it out.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_druid"><a class="anchor" href="#_druid"></a>Druid</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Druid is used to ingest the near real-time data from Kafka, store it and enable SQL access to it.
The demo has started an ingestion job reading earthquake records from the Kafka topic <code>earthquakes</code> and saving it into Druids deep storage.
The Druid deep storage is based on the S3 store provided by MinIO.</p>
</div>
<div class="sect2">
<h3 id="_view_ingestion_job"><a class="anchor" href="#_view_ingestion_job"></a>View ingestion job</h3>
<div class="paragraph">
<p>You can have a look at the ingestion job running in Druid by opening the given <code>druid</code> endpoint <code>router-http</code> from your <code>stackablectl services list</code> command output (<a href="http://172.18.0.4:30109" class="bare">http://172.18.0.4:30109</a> in this case).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/druid_1.png" alt="druid 1">
</div>
</div>
<div class="paragraph">
<p>By clicking on <code>Ingestion</code> at the top you can see the running ingestion jobs.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/druid_2.png" alt="druid 2">
</div>
</div>
<div class="paragraph">
<p>After clicking on the magnification glass to the right side of the <code>RUNNING</code> supervisor you can see additional information.
On the tab <code>Statistics</code> on the left you can see the number of processed records as well as the number of errors.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/druid_3.png" alt="druid 3">
</div>
</div>
<div class="paragraph">
<p>The statistics show that Druid is currently ingesting <code>1251</code> records/s and has ingested 2.1 million records so far.
All records have been ingested successfully, which is indicated by having no <code>processWithError</code>, <code>thrownAway</code> or <code>unparseable</code> records.</p>
</div>
</div>
<div class="sect2">
<h3 id="_query_the_data_source"><a class="anchor" href="#_query_the_data_source"></a>Query the data source</h3>
<div class="paragraph">
<p>The started ingestion job has automatically created the Druid data source <code>earthquakes</code>.
You can see the available data sources by clicking on <code>Datasources</code> at the top.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/druid_4.png" alt="druid 4">
</div>
</div>
<div class="paragraph">
<p>By clicking on the <code>earthquakes</code> data source you can see the segments the data source consists of.
In this case the <code>earthquakes</code> data source is partitioned by the year of the earthquake, resulting in 73 segments.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/druid_5.png" alt="druid 5">
</div>
</div>
<div class="paragraph">
<p>Druid offers a web-based way of querying the data sources via SQL.
To achieve this you first have to click on <code>Query</code> at the top.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/druid_6.png" alt="druid 6">
</div>
</div>
<div class="paragraph">
<p>You can now enter any arbitrary SQL statement, to e.g. list 10 earthquakes run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">select * from earthquakes limit 10</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/druid_7.png" alt="druid 7">
</div>
</div>
<div class="paragraph">
<p>To count the number of earthquakes per year run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">select
  time_format(__time, 'YYYY') as "year",
  count(*) as earthquakes
from earthquakes
group by 1
order by 1 desc</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/druid_8.png" alt="druid 8">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_superset"><a class="anchor" href="#_superset"></a>Superset</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Superset provides the ability to execute SQL queries and build dashboards.
Open the <code>superset</code> endpoint <code>external-superset</code> in your browser (<a href="http://172.18.0.3:32108" class="bare">http://172.18.0.3:32108</a> in this case).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/superset_1.png" alt="superset 1">
</div>
</div>
<div class="paragraph">
<p>Log in with the username <code>admin</code> and password <code>admin</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/superset_2.png" alt="superset 2">
</div>
</div>
<div class="sect2">
<h3 id="_view_dashboard"><a class="anchor" href="#_view_dashboard"></a>View dashboard</h3>
<div class="paragraph">
<p>The demo has created a Dashboard to visualize the earthquake data.
To open it click on the tab <code>Dashboards</code> at the top.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/superset_3.png" alt="superset 3">
</div>
</div>
<div class="paragraph">
<p>Click on the dashboard called <code>Earthquakes</code>.
It might take some time until the dashboards renders all the included charts.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/superset_4.png" alt="superset 4">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_view_charts"><a class="anchor" href="#_view_charts"></a>View charts</h3>
<div class="paragraph">
<p>The dashboard <code>Earthquakes</code> consists of multiple charts.
To list the charts click on the tab <code>Charts</code> at the top.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/superset_5.png" alt="superset 5">
</div>
</div>
<div class="paragraph">
<p>Click on the Chart <code>Number of earthquakes my magnitude</code>.
On the left side you can modify the chart and click on <code>Run</code> to see the effect.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/superset_6.png" alt="superset 6">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_view_the_earthquake_distribution_on_the_world_map"><a class="anchor" href="#_view_the_earthquake_distribution_on_the_world_map"></a>View the earthquake distribution on the world map</h3>
<div class="paragraph">
<p>To look at the geographical distribution of the earthquakes you have to click on the tab <code>Charts</code> at the top again.
Afterwards click on the chart <code>Earthquake distribution</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/superset_7.png" alt="superset 7">
</div>
</div>
<div class="paragraph">
<p>The distribution of the earthquakes matches the continental plate margins.
This is the expected distribution from the <a href="https://en.wikipedia.org/wiki/Earthquake">Wikipedia article on Earthquakes</a>.</p>
</div>
<div class="paragraph">
<p>You can move and zoom the map with your mouse to interactively explore the map.
You can e.g. have a detailed look at the detected earthquakes in Germany.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/superset_8.png" alt="superset 8">
</div>
</div>
<div class="paragraph">
<p>You can also click on the magnitudes in the legend on the top right side to enable/disable printing the earthquakes of that magnitude.
By only enabling magnitudes greater or equal to 8 you can plot only the most severe earthquakes.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/superset_9.png" alt="superset 9">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_execute_arbitrary_sql_statements"><a class="anchor" href="#_execute_arbitrary_sql_statements"></a>Execute arbitrary SQL statements</h3>
<div class="paragraph">
<p>Within Superset you can not only create dashboards but also run arbitrary SQL statements.
On the top click on the tab <code>SQL Lab</code> &#8594; <code>SQL Editor</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/superset_10.png" alt="superset 10">
</div>
</div>
<div class="paragraph">
<p>On the left select the database <code>druid</code>, the schema <code>druid</code> and set <code>See table schema</code> to <code>earthquakes</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/superset_11.png" alt="superset 11">
</div>
</div>
<div class="paragraph">
<p>On the right textbox enter the desired SQL statement.
If you do not want to make one up, you can use the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">select
  time_format(__time, 'YYYY') as "year",
  count(*) as earthquakes
from earthquakes
group by 1
order by 1 desc</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/superset_12.png" alt="superset 12">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_minio"><a class="anchor" href="#_minio"></a>MinIO</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The S3 provided by MinIO is used as a persistent deep storage for Druid to store all the data used.
Open the <code>minio</code> endpoint <code>console-http</code> in your browser (<a href="http://172.18.0.4:31664" class="bare">http://172.18.0.4:31664</a> in this case).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/minio_1.png" alt="minio 1">
</div>
</div>
<div class="paragraph">
<p>Log in with the username <code>root</code> and password <code>rootroot</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/minio_2.png" alt="minio 2">
</div>
</div>
<div class="paragraph">
<p>Click on the blue button <code>Browse</code> on the bucket <code>druid</code> and open the folders <code>data</code> &#8594; <code>earthquakes</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/minio_3.png" alt="minio 3">
</div>
</div>
<div class="paragraph">
<p>As you can see druid saved 199MB of data within 73 prefixes (folders).
One prefix corresponds to on segment which in turn contains all the data of a year.
If you don&#8217;t see any folders or files, the reason is that Druid has not saved its data from memory to the deep storage yet.
After waiting a few minutes, the data should have been flushed to S3 and show up.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-nifi-kafka-druid-earthquake-data/minio_4.png" alt="minio 4">
</div>
</div>
<div class="paragraph">
<p>If you open up a prefix for a specific year you can see that Druid has placed a file containing the data of that year there.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The demo streamed 10,000 earthquake records/s for a total of ~3 million earthquakes into a Kafka steaming pipeline.
Druid ingested the data near real-time into its data source and enabled SQL access to it.
Superset was used as a web-based frontend to execute SQL statements and build dashboards.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_where_to_go_from_here"><a class="anchor" href="#_where_to_go_from_here"></a>Where to go from here</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are multiple paths to go from here.
The following sections can give you some ideas on what to explore next.
You can find the description of the earthquake data <a href="https://earthquake.usgs.gov/earthquakes/feed/v1.0/csv.php">on the United States Geological Survey website</a>.</p>
</div>
<div class="sect2">
<h3 id="_execute_arbitrary_sql_statements_2"><a class="anchor" href="#_execute_arbitrary_sql_statements_2"></a>Execute arbitrary SQL statements</h3>
<div class="paragraph">
<p>Within Superset (or the Druid webinterface) you can execute arbitrary SQL statements to explore the earthquake data.</p>
</div>
</div>
<div class="sect2">
<h3 id="_create_additional_dashboards"><a class="anchor" href="#_create_additional_dashboards"></a>Create additional dashboards</h3>
<div class="paragraph">
<p>You also have the possibility to create additional charts and bundle them together in a Dashboard.
Have a look at <a href="https://superset.apache.org/docs/creating-charts-dashboards/creating-your-first-dashboard#creating-charts-in-explore-view">the Superset documentation</a> on how to do that.</p>
</div>
</div>
<div class="sect2">
<h3 id="_load_additional_data"><a class="anchor" href="#_load_additional_data"></a>Load additional data</h3>
<div class="paragraph">
<p>You can use the NiFi web interface to collect arbitrary data and write it to Kafka (it&#8217;s recommended to use new Kafka topics for that).
As an alternative you can use a Kafka client like <a href="https://github.com/edenhill/kcat">kafkacat</a> to create new topics and ingest data.
Using the Druid web interface, you can start an ingestion job that consumes the data and stores it in an internal data source.
There is a great <a href="https://druid.apache.org/docs/latest/tutorials/tutorial-kafka.html#loading-data-with-the-data-loader">tutorial</a> from Druid on how to do this.
Afterwards the data source is available to be analyzed within Druid and Superset the same way the earthquake data is.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
    </div>
</div>
<footer class="footer">
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
