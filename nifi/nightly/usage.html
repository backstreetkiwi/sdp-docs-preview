<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Usage :: Stackable Documentation</title>
    <link rel="canonical" href="https://docs.stackable.tech/nifi/stable/usage.html">
    <meta name="generator" content="Antora 3.1.0">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
    <link rel="icon" href="../../_/img/favicon.png" type="image/png">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://stackable.tech"><img src="../../_/img/stackable-logo.png"></a>
      <a class="navbar-item documentation-link" href="https://docs.stackable.tech">Documentation</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search...">
        </div>
      </div>
      <button class="navbar-burger" data-target="navbar-sub">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <a href="https://www.stackable.tech/contact/" class="button pull-right">Contact Us</a>
    </div>
      <div id="topbar-nav" class="navbar-menu">
      </div>
      </div>
    </nav>
    <nav id="navbar-sub" class="navbar-sub">
      <div class="container">
        <a class="navbar-sub-item" href="../../home/stable/index.html">Home</a>
<a class="navbar-sub-item" href="../../home/stable/getting_started.html">Getting Started</a>
<a class="navbar-sub-item" href="../../home/stable/concepts/index.html">Concepts</a>
<a class="navbar-sub-item" href="../../home/stable/tutorials/end-to-end_data_pipeline_example.html">Tutorials</a>
<a class="navbar-sub-item" href="../../stackablectl/stable/index.html">stackablectl</a>
<div class="navbar-sub-item drop-down">
    Operators
    <div class="drop-down-content">
        <a class="drop-down-item" href="../../home/stable/operators/index.html">Overview</a>
        <a class="drop-down-item" href="../../airflow/stable/index.html">Apache Airflow</a>
        <a class="drop-down-item" href="../../druid/stable/index.html">Apache Druid</a>
        <a class="drop-down-item" href="../../hbase/stable/index.html">Apache HBase</a>
        <a class="drop-down-item" href="../../hdfs/stable/index.html">Apache Hadoop HDFS</a>
        <a class="drop-down-item" href="../../hive/stable/index.html">Apache Hive</a>
        <a class="drop-down-item" href="../../kafka/stable/index.html">Apache Kafka</a>
        <a class="drop-down-item" href="../stable/index.html">Apache NiFi</a>
        <a class="drop-down-item" href="../../spark-k8s/stable/index.html">Apache Spark on K8S</a>
        <a class="drop-down-item" href="../../superset/stable/index.html">Apache Superset</a>
        <a class="drop-down-item" href="../../trino/stable/index.html">Trino</a>
        <a class="drop-down-item" href="../../zookeeper/stable/index.html">Apache ZooKeeper</a>
        <a class="drop-down-item" href="../../opa/stable/index.html">OpenPolicyAgent</a>
        <a class="drop-down-item" href="../../commons-operator/stable/index.html">Commons</a>
        <a class="drop-down-item" href="../../secret-operator/stable/index.html">Secret</a>
        <a class="drop-down-item" href="../../listener-operator/stable/index.html">Listener</a>
    </div>
</div>
<a class="navbar-sub-item" href="../../home/stable/contributor/index.html">Contribute</a>

        <a class="arrow" href="javascript:document.querySelector('.navbar-sub').classList.toggle('open')">
          <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"></path></svg>
        </a>
      </div>
    </nav>
  </header>
<div class="body">
    <div class="container">
<div class="nav-container" data-component="nifi" data-version="nightly">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <div class="title-wrapper">
      <h3 class="title"><a href="index.html">Stackable Operator for Apache NiFi</a></h3>
      <div class="page-versions">
        <button class="version-menu-toggle" title="Show other versions of page">nightly</button>
        <div class="version-menu">
          <a class="version is-current" href="usage.html">nightly</a>
          <a class="version" href="../stable/usage.html">0.8</a>
          <a class="version" href="../0.7/usage.html">0.7</a>
          <a class="version" href="../0.6/usage.html">0.6</a>
        </div>
      </div>
    </div>
    <ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="getting_started/index.html">Getting started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="getting_started/installation.html">Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="getting_started/first_steps.html">First steps</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="dependencies.html">Dependencies</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="configuration.html">Configuration</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="usage.html">Usage</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Stackable Operator for Apache NiFi</span>
    <span class="version">nightly</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../commons-operator/stable/index.html">Stackable Commons Operator</a>
      <ul class="versions">
        <li class="version">
          <a href="../../commons-operator/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../commons-operator/stable/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../commons-operator/0.3/index.html">0.3</a>
        </li>
        <li class="version">
          <a href="../../commons-operator/0.2/index.html">0.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../home/stable/index.html">Stackable Documentation</a>
      <ul class="versions">
        <li class="version">
          <a href="../../home/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../home/stable/index.html">22.11</a>
        </li>
        <li class="version">
          <a href="../../home/22.09/index.html">22.09</a>
        </li>
        <li class="version">
          <a href="../../home/22.06/index.html">22.06</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../listener-operator/stable/index.html">Stackable Listener Operator</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../listener-operator/stable/index.html">nightly</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../airflow/stable/index.html">Stackable Operator for Apache Airflow</a>
      <ul class="versions">
        <li class="version">
          <a href="../../airflow/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../airflow/stable/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../airflow/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../airflow/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../airflow/0.3/index.html">0.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../druid/stable/index.html">Stackable Operator for Apache Druid</a>
      <ul class="versions">
        <li class="version">
          <a href="../../druid/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../druid/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../druid/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../druid/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../druid/0.2/index.html">0.2</a>
        </li>
        <li class="version">
          <a href="../../druid/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../hbase/stable/index.html">Stackable Operator for Apache HBase</a>
      <ul class="versions">
        <li class="version">
          <a href="../../hbase/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../hbase/stable/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../hbase/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../hbase/0.3/index.html">0.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../hdfs/stable/index.html">Stackable Operator for Apache HDFS</a>
      <ul class="versions">
        <li class="version">
          <a href="../../hdfs/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../hdfs/stable/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../hdfs/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../hdfs/0.4/index.html">0.4</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../hive/stable/index.html">Stackable Operator for Apache Hive</a>
      <ul class="versions">
        <li class="version">
          <a href="../../hive/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../hive/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../hive/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../hive/0.6/index.html">0.6</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../kafka/stable/index.html">Stackable Operator for Apache Kafka</a>
      <ul class="versions">
        <li class="version">
          <a href="../../kafka/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../kafka/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../kafka/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../kafka/0.6/index.html">0.6</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../stable/index.html">Stackable Operator for Apache NiFi</a>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../0.6/index.html">0.6</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../spark-k8s/stable/index.html">Stackable Operator for Apache Spark on Kubernetes</a>
      <ul class="versions">
        <li class="version">
          <a href="../../spark-k8s/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../spark-k8s/stable/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../spark-k8s/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../spark-k8s/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../spark-k8s/0.3/index.html">0.3</a>
        </li>
        <li class="version">
          <a href="../../spark-k8s/0.2/index.html">0.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../superset/stable/index.html">Stackable Operator for Apache Superset</a>
      <ul class="versions">
        <li class="version">
          <a href="../../superset/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../superset/stable/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../superset/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../superset/0.5/index.html">0.5</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../zookeeper/stable/index.html">Stackable Operator for Apache ZooKeeper</a>
      <ul class="versions">
        <li class="version">
          <a href="../../zookeeper/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../zookeeper/stable/index.html">0.12</a>
        </li>
        <li class="version">
          <a href="../../zookeeper/0.11/index.html">0.11</a>
        </li>
        <li class="version">
          <a href="../../zookeeper/0.10/index.html">0.10</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../opa/stable/index.html">Stackable Operator for OPA</a>
      <ul class="versions">
        <li class="version">
          <a href="../../opa/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../opa/stable/index.html">0.11</a>
        </li>
        <li class="version">
          <a href="../../opa/0.10/index.html">0.10</a>
        </li>
        <li class="version">
          <a href="../../opa/0.9/index.html">0.9</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../trino/stable/index.html">Stackable Operator for Trino</a>
      <ul class="versions">
        <li class="version">
          <a href="../../trino/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../trino/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../trino/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../trino/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../trino/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../trino/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../trino/0.3/index.html">0.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../secret-operator/stable/index.html">Stackable Secret Operator</a>
      <ul class="versions">
        <li class="version">
          <a href="../../secret-operator/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../secret-operator/stable/index.html">0.5</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../stackablectl/stable/index.html">stackablectl</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../stackablectl/stable/index.html">nightly</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../home/stable/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Stackable Operator for Apache NiFi</a></li>
    <li><a href="usage.html">Usage</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/stackabletech/nifi-operator/edit/main/docs/modules/ROOT/pages/usage.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Usage</h1>
<div class="sect1">
<h2 id="_setup_prerequisites"><a class="anchor" href="#_setup_prerequisites"></a>Setup Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache Nifi requires Apache ZooKeeper to run. This page assumes you already installed the Stackable operators for both of these products.</p>
</div>
<div class="paragraph">
<p>For details regarding the <a href="https://github.com/stackabletech/zookeeper-operator">Stackable Operator for Apache ZooKeeper</a> see the <a href="../../zookeeper/stable/index.html" class="xref page">documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_an_apache_nifi_cluster"><a class="anchor" href="#_create_an_apache_nifi_cluster"></a>Create an Apache Nifi cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An Apache NiFi cluster running on three nodes with SingleUser authentication is described as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: nifi.stackable.tech/v1alpha1
kind: NifiCluster
metadata:
  name: simple-nifi <i class="conum" data-value="1"></i><b>(1)</b>
spec:
  version: 1.16.3-stackable0.1.0 <i class="conum" data-value="2"></i><b>(2)</b>
  zookeeperConfigMapName: simple-nifi-znode <i class="conum" data-value="3"></i><b>(3)</b>
  config:
    authentication:
      method:
        singleUser:
          adminCredentialsSecret: nifi-admin-credentials-simple <i class="conum" data-value="4"></i><b>(4)</b>
          autoGenerate: true
    sensitiveProperties:
      keySecret: nifi-sensitive-property-key
  nodes:
    roleGroups:
      default:
        selector:
          matchLabels:
            kubernetes.io/os: linux
        config:
          log:
            rootLogLevel: INFO
        replicas: 3</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Name of the Nifi cluster.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Version of the Apache Nifi container image to use. This contains the Nifi version (<code>1.16.3</code>) as well as Stackable image version (<code>stackable0.1.0</code>). For a list of available versions please check our <a href="https://repo.stackable.tech/#browse/browse:docker:v2%2Fstackable%2Fnifi%2Ftags">image registry</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A reference to a <code>ZNode</code> resource. This resource must exist and cannot be reused across Nifi clusters. For details on how to create <code>ZNode</code> resources see <a href="../../zookeeper/stable/znodes.html" class="xref page">this page</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Administator credentials for logging into the Nifi web interface. This is the name of a <code>Secret</code> resource with two fields: <code>username</code> and <code>password</code>. This <code>Secret</code> must exist but it&#8217;s entries can be populated by the operator when <code>autoGenerate</code> is <code>true</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_authentication"><a class="anchor" href="#_authentication"></a>Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every user has to authenticate themselves before using NiFI.
There are multiple options to set up the authentication of users.</p>
</div>
<div class="sect2">
<h3 id="_single_user"><a class="anchor" href="#_single_user"></a>Single user</h3>
<div class="paragraph">
<p>The default setting is to only provision a single user with administrative privileges.
You need to specify the username and password of the user.
Further users can not be added.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ldap"><a class="anchor" href="#_ldap"></a>LDAP</h3>
<div class="paragraph">
<p>NiFI supports authentication of users against an LDAP server.
Have a look at <a href="https://github.com/stackabletech/nifi-operator/tree/main/tests/templates/kuttl/ldap">the LDAP test</a> and the general <a href="../../commons-operator/stable/authenticationclass.html" class="xref page">Stackable Authentication</a> documentation on how to set it up.
In general, it requires you to specify a <a href="../../commons-operator/stable/authenticationclass.html" class="xref page"><code>AuthenticationClass</code></a> which is used to authenticate the users.
Here you have an example usage</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">---
apiVersion: nifi.stackable.tech/v1alpha1
kind: NifiCluster
metadata:
  name: test-nifi
spec:
  config:
    authentication:
      method:
        authenticationClass: ldap-without-tls
---
apiVersion: authentication.stackable.tech/v1alpha1
kind: AuthenticationClass
metadata:
  name: ldap-without-tls
spec:
  provider:
    ldap:
      hostname: openldap.default.svc.cluster.local
      searchBase: ou=users,dc=example,dc=org
      bindCredentials:
        secretClass: nifi-with-ldap-bind
      port: 1389
---
apiVersion: secrets.stackable.tech/v1alpha1
kind: SecretClass
metadata:
  name: nifi-with-ldap-bind
spec:
  backend:
    k8sSearch:
      searchNamespace:
        pod: {}
---
apiVersion: v1
kind: Secret
metadata:
  name: nifi-with-ldap-bind
  labels:
    secrets.stackable.tech/class: nifi-with-ldap-bind
stringData:
  user: cn=integrationtest,ou=users,dc=example,dc=org
  password: integrationtest</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_authorization"><a class="anchor" href="#_authorization"></a>Authorization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NiFi supports multiple authorization methods documented <a href="https://nifi.apache.org/docs/nifi-docs/html/administration-guide.html#multi-tenant-authorization">here</a>.
The available authorization methods depend on the chosen authentication method.</p>
</div>
<div class="paragraph">
<p>Authorization is not fully implemented by the Stackable Operator for Apache Nifi.</p>
</div>
<div class="sect2">
<h3 id="_single_user_2"><a class="anchor" href="#_single_user_2"></a>Single user</h3>
<div class="paragraph">
<p>With this authorization methid, a single user has administrator capabilites.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ldap_2"><a class="anchor" href="#_ldap_2"></a>LDAP</h3>
<div class="paragraph">
<p>The operator uses the <a href="https://nifi.apache.org/docs/nifi-docs/html/administration-guide.html#fileusergroupprovider"><code>FileUserGroupProvider</code></a> and <a href="https://nifi.apache.org/docs/nifi-docs/html/administration-guide.html#fileaccesspolicyprovider">FileAccessPolicyProvider</a> to bind the LDAP user to the Nifi administrator group. This user is then able to create and modify groups and polices in the web interface. These changes local to the <code>Pod</code> running Nifi and are <strong>not</strong> persistent.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_updating_nifi"><a class="anchor" href="#_updating_nifi"></a>Updating NiFi</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Updating (or downgrading for that matter) the deployed version of NiFi is as simple as changing the version stated in the CRD.
Continuing the example above, to change the deployed version from <code>1.16.3</code> to <code>1.16.2</code> you&#8217;d simply deploy the following CRD.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: nifi.stackable.tech/v1alpha1
kind: NifiCluster
metadata:
  name: simple-nifi
spec:
  version: 1.16.2-stackable0.1.0 <i class="conum" data-value="1"></i><b>(1)</b>
  zookeeperConfigMapName: simple-nifi-znode
  config:
    authentication:
      method:
        singleUser:
          adminCredentialsSecret: nifi-admin-credentials-simple
    sensitiveProperties:
      keySecret: nifi-sensitive-property-key
  nodes:
    roleGroups:
      default:
        selector:
          matchLabels:
            kubernetes.io/os: linux
        config:
          log:
            rootLogLevel: INFO
        replicas: 3</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Change the NiFi version here</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Due to a limitation in NiFi itself it is not possible to up- or downgrade a NiFi cluster in a rolling fashion.
So any change to the NiFi version you make in this CRD will result in a full cluster restart with a short downtime.
This does not affect the stackable image version, this can be changed in a rolling fashion, as long as the underlying NiFi version remains unchanged.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring"><a class="anchor" href="#_monitoring"></a>Monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The managed NiFi cluster is automatically configured to export Prometheus metrics. See
<a href="../../home/stable/operators/monitoring.html" class="xref page">Monitoring</a> for more details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_environment_overrides"><a class="anchor" href="#_configuration_environment_overrides"></a>Configuration &amp; Environment Overrides</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The cluster definition also supports overriding configuration properties and environment variables, either per role or per role group, where the more specific override (role group) has precedence over the less specific one (role).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Do not override port numbers.
This will lead to cluster malfunction.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_configuration_overrides"><a class="anchor" href="#_configuration_overrides"></a>Configuration Overrides</h3>
<div class="paragraph">
<p>Apache NiFi runtime configuration is stored in the files bootstrap.conf and nifi.properties.
The <code>configOverrides</code> block enables you to customize parameters in these files.
The complete list of the configuration options can be found in the  <a href="https://nifi.apache.org/docs/nifi-docs/html/administration-guide.html#system_properties">Apache NiFi documentation</a>.</p>
</div>
<div class="paragraph">
<p>Overrides are key, value pairs defined under a Nifi configuration file such as <code>bootstrap.conf</code> or <code>nifi.properties</code>. They must match the names values as expected by Nifi. In the example below a property <code>aws.region</code> is being explicitly set to 'eu-west-1', overriding the default value.</p>
</div>
<div class="paragraph">
<p>The following snippet shows how to disable workflow file backups in the NifiCluster definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">configOverrides:
  nifi.properties:
    nifi.flow.configuration.archive.enabled: false</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Please be aware that by overriding config settings in this section you have a very high risk of breaking things, because the product does not behave the way the Stackable Operator for Apache NiFi expects it to behave anymore.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_environment_variables"><a class="anchor" href="#_environment_variables"></a>Environment Variables</h3>
<div class="paragraph">
<p>Environment variables can be (over)written by adding the <code>envOverrides</code> property.</p>
</div>
<div class="paragraph">
<p>For example per role group:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">nodes:
  roleGroups:
    default:
      config: {}
      replicas: 1
      envOverrides:
        MY_ENV_VAR: "MY_VALUE"</code></pre>
</div>
</div>
<div class="paragraph">
<p>or per role:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">nodes:
  envOverrides:
    MY_ENV_VAR: "MY_VALUE"
  roleGroups:
    default:
      config: {}
      replicas: 1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_volume_storage"><a class="anchor" href="#_volume_storage"></a>Volume storage</h3>
<div class="paragraph">
<p>By default, a Nifi cluster will create five different persistent volume claims for flow files, provenance, database, content and state folders. These PVCs will request <code>2Gi</code>. It is recommended that you configure these volume requests according to your needs.</p>
</div>
<div class="paragraph">
<p>Storage requests can be configured at role or group level, for one or more of the persistent volumes as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">nodes:
  roleGroups:
    default:
      config:
        resources:
          storage:
            flowfile_repo:
              capacity: 12Gi
            provenance_repo:
              capacity: 12Gi
            database_repo:
              capacity: 12Gi
            content_repo:
              capacity: 12Gi
            state_repo:
              capacity: 12Gi</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, all nodes in the default group will request <code>12Gi</code> of storage the various folders.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resource_requests"><a class="anchor" href="#_resource_requests"></a>Resource Requests</h3>
<div class="paragraph">
<p>Stackable operators handle resource requests in a sligtly different manner than Kubernetes. Resource requests are defined on role or group level. See <a href="../../home/stable/concepts/roles-and-role-groups.html" class="xref page">Roles and role groups</a> for details on these concepts. On a role level this means that e.g. all workers will use the same resource requests and limits. This can be further specified on role group level (which takes priority to the role level) to apply different resources.</p>
</div>
<div class="paragraph">
<p>This is an example on how to specify CPU and memory resources using the Stackable <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">Custom Resources</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">---
apiVersion: example.stackable.tech/v1alpha1
kind: ExampleCluster
metadata:
  name: example
spec:
  workers: # role-level
    config:
      resources:
        cpu:
          min: 300m
          max: 600m
        memory:
          limit: 3Gi
    roleGroups: # role-group-level
      resources-from-role: # role-group 1
        replicas: 1
      resources-from-role-group: # role-group 2
        replicas: 1
        config:
          resources:
            cpu:
              min: 400m
              max: 800m
            memory:
              limit: 4Gi</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the role group <code>resources-from-role</code> will inherit the resources specified on the role level. Resulting in a maximum of <code>3Gi</code> memory and <code>600m</code> CPU resources.</p>
</div>
<div class="paragraph">
<p>The role group <code>resources-from-role-group</code> has maximum of <code>4Gi</code> memory and <code>800m</code> CPU resources (which overrides the role CPU resources).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
For Java products the actual used Heap memory is lower than the specified memory limit due to other processes in the Container requiring memory to run as well. Currently, 80% of the specified memory limits is passed to the JVM.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For memory only a limit can be specified, which will be set as memory request and limit in the Container. This is to always guarantee a Container the full amount memory during Kubernetes scheduling.</p>
</div>
<div class="paragraph">
<p>If no resource requests are configured explicitly, the Nifi operator uses the following defaults:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">nodes:
  roleGroups:
    default:
      config:
        resources:
          cpu:
            min: "500m"
            max: "4"
          memory:
            limit: '2Gi'
          storage:
            flowfile_repo:
              capacity: 2Gi
            provenance_repo:
              capacity: 2Gi
            database_repo:
              capacity: 2Gi
            content_repo:
              capacity: 2Gi
            state_repo:
              capacity: 2Gi</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
    </div>
</div>
<footer class="footer">
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
