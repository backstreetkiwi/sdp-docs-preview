<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Job Dependencies :: Stackable Documentation</title>
    <link rel="canonical" href="https://docs.stackable.tech/spark-k8s/stable/job_dependencies.html">
    <meta name="generator" content="Antora 3.1.0">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
    <link rel="icon" href="../../_/img/favicon.png" type="image/png">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://stackable.tech"><img src="../../_/img/stackable-logo.png"></a>
      <a class="navbar-item documentation-link" href="https://docs.stackable.tech">Documentation</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search...">
        </div>
      </div>
      <button class="navbar-burger" data-target="navbar-sub">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <a href="https://www.stackable.tech/contact/" class="button pull-right">Contact Us</a>
    </div>
      <div id="topbar-nav" class="navbar-menu">
      </div>
      </div>
    </nav>
    <nav id="navbar-sub" class="navbar-sub">
      <div class="container">
        <a class="navbar-sub-item" href="../../home/stable/index.html">Home</a>
<a class="navbar-sub-item" href="../../home/stable/getting_started.html">Getting Started</a>
<a class="navbar-sub-item" href="../../home/stable/concepts/index.html">Concepts</a>
<a class="navbar-sub-item" href="../../home/stable/tutorials/end-to-end_data_pipeline_example.html">Tutorials</a>
<a class="navbar-sub-item" href="../../stackablectl/stable/index.html">stackablectl</a>
<div class="navbar-sub-item drop-down">
    Operators
    <div class="drop-down-content">
        <a class="drop-down-item" href="../../home/stable/operators/index.html">Overview</a>
        <a class="drop-down-item" href="../../airflow/stable/index.html">Apache Airflow</a>
        <a class="drop-down-item" href="../../druid/stable/index.html">Apache Druid</a>
        <a class="drop-down-item" href="../../hbase/stable/index.html">Apache HBase</a>
        <a class="drop-down-item" href="../../hdfs/stable/index.html">Apache Hadoop HDFS</a>
        <a class="drop-down-item" href="../../hive/stable/index.html">Apache Hive</a>
        <a class="drop-down-item" href="../../kafka/stable/index.html">Apache Kafka</a>
        <a class="drop-down-item" href="../../nifi/stable/index.html">Apache NiFi</a>
        <a class="drop-down-item" href="../stable/index.html">Apache Spark on K8S</a>
        <a class="drop-down-item" href="../../superset/stable/index.html">Apache Superset</a>
        <a class="drop-down-item" href="../../trino/stable/index.html">Trino</a>
        <a class="drop-down-item" href="../../zookeeper/stable/index.html">Apache ZooKeeper</a>
        <a class="drop-down-item" href="../../opa/stable/index.html">OpenPolicyAgent</a>
        <a class="drop-down-item" href="../../commons-operator/stable/index.html">Commons</a>
        <a class="drop-down-item" href="../../secret-operator/stable/index.html">Secret</a>
        <a class="drop-down-item" href="../../listener-operator/stable/index.html">Listener</a>
    </div>
</div>
<a class="navbar-sub-item" href="../../home/stable/contributor/index.html">Contribute</a>

        <a class="arrow" href="javascript:document.querySelector('.navbar-sub').classList.toggle('open')">
          <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"></path></svg>
        </a>
      </div>
    </nav>
  </header>
<div class="body">
    <div class="container">
<div class="nav-container" data-component="spark-k8s" data-version="nightly">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <div class="title-wrapper">
      <h3 class="title"><a href="index.html">Stackable Operator for Apache Spark on Kubernetes</a></h3>
      <div class="page-versions">
        <button class="version-menu-toggle" title="Show other versions of page">nightly</button>
        <div class="version-menu">
          <a class="version is-current" href="job_dependencies.html">nightly</a>
          <a class="version" href="../stable/job_dependencies.html">0.6</a>
          <a class="version" href="../0.5/job_dependencies.html">0.5</a>
          <a class="version" href="../0.4/job_dependencies.html">0.4</a>
          <a class="version" href="../0.3/job_dependencies.html">0.3</a>
          <a class="version" href="../0.2/job_dependencies.html">0.2</a>
        </div>
      </div>
    </div>
    <ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="getting_started/index.html">Getting started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="getting_started/installation.html">Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="getting_started/first_steps.html">First steps</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="configuration.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="usage.html">Usage</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="job_dependencies.html">Job Dependencies</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="rbac.html">RBAC</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Stackable Operator for Apache Spark on Kubernetes</span>
    <span class="version">nightly</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../commons-operator/stable/index.html">Stackable Commons Operator</a>
      <ul class="versions">
        <li class="version">
          <a href="../../commons-operator/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../commons-operator/stable/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../commons-operator/0.3/index.html">0.3</a>
        </li>
        <li class="version">
          <a href="../../commons-operator/0.2/index.html">0.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../home/stable/index.html">Stackable Documentation</a>
      <ul class="versions">
        <li class="version">
          <a href="../../home/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../home/stable/index.html">22.11</a>
        </li>
        <li class="version">
          <a href="../../home/22.09/index.html">22.09</a>
        </li>
        <li class="version">
          <a href="../../home/22.06/index.html">22.06</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../listener-operator/stable/index.html">Stackable Listener Operator</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../listener-operator/stable/index.html">nightly</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../airflow/stable/index.html">Stackable Operator for Apache Airflow</a>
      <ul class="versions">
        <li class="version">
          <a href="../../airflow/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../airflow/stable/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../airflow/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../airflow/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../airflow/0.3/index.html">0.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../druid/stable/index.html">Stackable Operator for Apache Druid</a>
      <ul class="versions">
        <li class="version">
          <a href="../../druid/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../druid/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../druid/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../druid/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../druid/0.2/index.html">0.2</a>
        </li>
        <li class="version">
          <a href="../../druid/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../hbase/stable/index.html">Stackable Operator for Apache HBase</a>
      <ul class="versions">
        <li class="version">
          <a href="../../hbase/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../hbase/stable/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../hbase/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../hbase/0.3/index.html">0.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../hdfs/stable/index.html">Stackable Operator for Apache HDFS</a>
      <ul class="versions">
        <li class="version">
          <a href="../../hdfs/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../hdfs/stable/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../hdfs/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../hdfs/0.4/index.html">0.4</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../hive/stable/index.html">Stackable Operator for Apache Hive</a>
      <ul class="versions">
        <li class="version">
          <a href="../../hive/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../hive/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../hive/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../hive/0.6/index.html">0.6</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../kafka/stable/index.html">Stackable Operator for Apache Kafka</a>
      <ul class="versions">
        <li class="version">
          <a href="../../kafka/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../kafka/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../kafka/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../kafka/0.6/index.html">0.6</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../nifi/stable/index.html">Stackable Operator for Apache NiFi</a>
      <ul class="versions">
        <li class="version">
          <a href="../../nifi/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../nifi/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../nifi/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../nifi/0.6/index.html">0.6</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../stable/index.html">Stackable Operator for Apache Spark on Kubernetes</a>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../stable/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../0.3/index.html">0.3</a>
        </li>
        <li class="version">
          <a href="../0.2/index.html">0.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../superset/stable/index.html">Stackable Operator for Apache Superset</a>
      <ul class="versions">
        <li class="version">
          <a href="../../superset/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../superset/stable/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../superset/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../superset/0.5/index.html">0.5</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../zookeeper/stable/index.html">Stackable Operator for Apache ZooKeeper</a>
      <ul class="versions">
        <li class="version">
          <a href="../../zookeeper/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../zookeeper/stable/index.html">0.12</a>
        </li>
        <li class="version">
          <a href="../../zookeeper/0.11/index.html">0.11</a>
        </li>
        <li class="version">
          <a href="../../zookeeper/0.10/index.html">0.10</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../opa/stable/index.html">Stackable Operator for OPA</a>
      <ul class="versions">
        <li class="version">
          <a href="../../opa/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../opa/stable/index.html">0.11</a>
        </li>
        <li class="version">
          <a href="../../opa/0.10/index.html">0.10</a>
        </li>
        <li class="version">
          <a href="../../opa/0.9/index.html">0.9</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../trino/stable/index.html">Stackable Operator for Trino</a>
      <ul class="versions">
        <li class="version">
          <a href="../../trino/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../trino/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../trino/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../trino/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../trino/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../trino/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../trino/0.3/index.html">0.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../secret-operator/stable/index.html">Stackable Secret Operator</a>
      <ul class="versions">
        <li class="version">
          <a href="../../secret-operator/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../secret-operator/stable/index.html">0.5</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../stackablectl/stable/index.html">stackablectl</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../stackablectl/stable/index.html">nightly</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../home/stable/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Stackable Operator for Apache Spark on Kubernetes</a></li>
    <li><a href="job_dependencies.html">Job Dependencies</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/stackabletech/spark-k8s-operator/edit/main/docs/modules/ROOT/pages/job_dependencies.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Job Dependencies</h1>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Stackable Spark-on-Kubernetes operator enables users to run Apache Spark workloads in a Kubernetes cluster easily by eliminating the requirement of having a local Spark installation. For this purpose, Stackble provides ready made Docker images with recent versions of Apache Spark and Python - for PySpark jobs - that provide the basis for running those workloads. Users of the Stackable Spark-on-Kubernetes operator can run their workloads on any recent Kubernetes cluster by applying a <code>SparkApplication</code> custom resource in which the job code, job dependencies, input and output data locations can be specified. The Stackable operator translates the user&#8217;s <code>SparkApplication</code> manifest into a Kubernetes <code>Job</code> object and handles control to the Apache Spark scheduler for Kubernetes to construct the necessary driver and executor <code>Pods</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/spark-k8s.png" alt="Job Flow">
</div>
</div>
<div class="paragraph">
<p>When the job is finished, the <code>Pods</code> are terminated and the Kubernetes <code>Job</code> is completed.</p>
</div>
<div class="paragraph">
<p>The base images provided by Stackable contain only the minimum of components to run Spark workloads. This is done mostly for performance and compatibility reasons. Many Spark workloads build on top of third party libraries and frameworks and thus depend on additional packages that are not included in the Stackable images. This guide explains how users can provision their Spark jobs with additional dependencies.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dependency_provisioning"><a class="anchor" href="#_dependency_provisioning"></a>Dependency provisioning</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are multiple ways to submit Apache Spark jobs with external dependencies. Each has its own advantages and disadvantages and the choice of one over the other depends on existing technical and managerial constraints.</p>
</div>
<div class="paragraph">
<p>To provision job dependencies in their workloads, users have to construct their <code>SparkApplication</code> with one of the following dependency specifications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hardened or encapsulated job images</p>
</li>
<li>
<p>Dependency volumes</p>
</li>
<li>
<p>Spark native package coordinates and Python requirements</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following table provides a high level overview of the relevant aspects of each method.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dependency specification</th>
<th class="tableblock halign-left valign-top">Job image size</th>
<th class="tableblock halign-left valign-top">Reproduciblity</th>
<th class="tableblock halign-left valign-top">Dev-op cost</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encapsulated job images</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Large</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Guaranteed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Medium to High</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dependency volumes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Small</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Guaranteed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Small to Medium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spark and Python packages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Small</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not guranteed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Small</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_hardened_or_encapsulated_job_images"><a class="anchor" href="#_hardened_or_encapsulated_job_images"></a>Hardened or encapsulated job images</h3>
<div class="paragraph">
<p>With this method, users submit a <code>SparkApplication</code> for which the <code>sparkImage</code> refers to a Docker image containing Apache Spark itself, the job code and dependencies required by the job. It is recommended the users base their image on one of the Stackable images to ensure compatibility with the Stackable operator.</p>
</div>
<div class="paragraph">
<p>Since all packages required to run the Spark job are bundled in the image, the size of this image tends to get very large while at the same time guaranteeing reproducibility between submissions.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">---
apiVersion: spark.stackable.tech/v1alpha1
kind: SparkApplication
metadata:
  name: spark-pi
spec:
  version: "1.0"
  sparkImage: docker.stackable.tech/stackable/spark-k8s:3.3.0-stackable0.2.0 <i class="conum" data-value="1"></i><b>(1)</b>
  mode: cluster
  mainClass: org.apache.spark.examples.SparkPi
  mainApplicationFile: /stackable/spark/examples/jars/spark-examples_2.12-3.3.0.jar <i class="conum" data-value="2"></i><b>(2)</b>
  executor:
    instances: 3</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Name of the encapsulated image.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Name of the Spark job to run.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_dependency_volumes"><a class="anchor" href="#_dependency_volumes"></a>Dependency volumes</h3>
<div class="paragraph">
<p>With this method, the user provisions the job dependencies from a <code>PersistentVolume</code> as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">---
apiVersion: spark.stackable.tech/v1alpha1
kind: SparkApplication
metadata:
  name: example-sparkapp-pvc
  namespace: default
spec:
  version: "1.0"
  sparkImage: docker.stackable.tech/stackable/spark-k8s:3.3.0-stackable0.2.0
  mode: cluster
  mainApplicationFile: s3a://stackable-spark-k8s-jars/jobs/ny-tlc-report-1.0-SNAPSHOT.jar <i class="conum" data-value="1"></i><b>(1)</b>
  mainClass: org.example.App <i class="conum" data-value="2"></i><b>(2)</b>
  args:
    - "'s3a://nyc-tlc/trip data/yellow_tripdata_2021-07.csv'"
  sparkConf: <i class="conum" data-value="3"></i><b>(3)</b>
    "spark.hadoop.fs.s3a.aws.credentials.provider": "org.apache.hadoop.fs.s3a.AnonymousAWSCredentialsProvider"
    "spark.driver.extraClassPath": "/dependencies/jars/*"
    "spark.executor.extraClassPath": "/dependencies/jars/*"
  volumes:
    - name: job-deps <i class="conum" data-value="4"></i><b>(4)</b>
      persistentVolumeClaim:
        claimName: pvc-ksv
  driver:
    volumeMounts:
      - name: job-deps
        mountPath: /dependencies <i class="conum" data-value="5"></i><b>(5)</b>
  executor:
    instances: 3
    volumeMounts:
      - name: job-deps
        mountPath: /dependencies <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Job artifact located on S3.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Job main class</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Spark dependencies: the credentials provider (the user knows what is relevant here) plus dependencies needed to access external resources (in this case, in s3, accessed without credentials)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the name of the volume mount backed by a <code>PersistentVolumeClaim</code> that must be pre-existing</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the path on the volume mount: this is referenced in the <code>sparkConf</code> section where the extra class path is defined for the driver and executors</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Spark operator has no control over the contents of the dependency volume. It is the responsibility of the user to make sure all required dependencies are installed in the correct versions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A <code>PersistentVolumeClaim</code> and the associated <code>PersistentVolume</code> can be defined like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv-ksv <i class="conum" data-value="1"></i><b>(1)</b>
spec:
  storageClassName: standard
  accessModes:
    - ReadWriteOnce
  capacity:
    storage: 2Gi
  hostPath:
    path: /some-host-location
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: pvc-ksv <i class="conum" data-value="2"></i><b>(2)</b>
spec:
  volumeName: pv-ksv <i class="conum" data-value="1"></i><b>(1)</b>
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi
---
apiVersion: batch/v1
kind: Job
metadata:
  name: aws-deps
spec:
  template:
    spec:
      restartPolicy: Never
      volumes:
        - name: job-deps <i class="conum" data-value="3"></i><b>(3)</b>
          persistentVolumeClaim:
            claimName: pvc-ksv <i class="conum" data-value="2"></i><b>(2)</b>
      containers:
        - name: aws-deps
          volumeMounts:
            - name: job-deps <i class="conum" data-value="4"></i><b>(4)</b>
              mountPath: /stackable/spark/dependencies</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Reference to a <code>PersistentVolume</code>, defining some cluster-reachable storage</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The name of the <code>PersistentVolumeClaim</code> that references the PV</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Defines a <code>Volume</code> backed by the PVC, local to the Custom Resource</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Defines the <code>VolumeMount</code> that is used by the Custom Resource</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_spark_native_package_coordinates_and_python_requirements"><a class="anchor" href="#_spark_native_package_coordinates_and_python_requirements"></a>Spark native package coordinates and Python requirements</h3>
<div class="paragraph">
<p>The last and most flexible way to provision dependencies is to use the built-in <code>spark-submit</code> support for Maven package coordinates.</p>
</div>
<div class="paragraph">
<p>These can be specified by adding the following section to the <code>SparkApplication</code> manifest file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spec:
  deps:
    repositories:
      - https://repository.example.com/prod
    packages:
      - com.example:some-package:1.0.0
    excludePackages:
      - com.example:other-package</code></pre>
</div>
</div>
<div class="paragraph">
<p>These directly translate to the spark-submit parameters <code>--packages</code>, <code>--exclude-packages</code>, and <code>--repositories</code>.</p>
</div>
<div class="paragraph">
<p>When submitting PySpark jobs, users can specify <code>pip</code> requirements that are installed before the driver and executor pods are created.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">---
apiVersion: spark.stackable.tech/v1alpha1
kind: SparkApplication
metadata:
  name: example-sparkapp-external-dependencies
  namespace: default
spec:
  version: "1.0"
  sparkImage: docker.stackable.tech/stackable/pyspark-k8s:3.3.0-stackable0.2.0
  mode: cluster
  mainApplicationFile: s3a://stackable-spark-k8s-jars/jobs/ny_tlc_report.py <i class="conum" data-value="1"></i><b>(1)</b>
  args:
    - "--input 's3a://nyc-tlc/trip data/yellow_tripdata_2021-07.csv'" <i class="conum" data-value="2"></i><b>(2)</b>
  deps:
    requirements:
      - tabulate==0.8.9  <i class="conum" data-value="3"></i><b>(3)</b>
  sparkConf:  <i class="conum" data-value="4"></i><b>(4)</b>
    "spark.hadoop.fs.s3a.aws.credentials.provider": "org.apache.hadoop.fs.s3a.AnonymousAWSCredentialsProvider"
    "spark.driver.extraClassPath": "/dependencies/jars/*"
    "spark.executor.extraClassPath": "/dependencies/jars/*"
  volumes:
    - name: job-deps  <i class="conum" data-value="5"></i><b>(5)</b>
      persistentVolumeClaim:
        claimName: pvc-ksv
  driver:
    volumeMounts:
      - name: job-deps
        mountPath: /dependencies  <i class="conum" data-value="6"></i><b>(6)</b>
  executor:
    instances: 3
    volumeMounts:
      - name: job-deps
        mountPath: /dependencies  <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the section <code>requirements</code>. Also note that in this case, a <code>sparkImage</code> that bundles Python has to be provisioned.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
    </div>
</div>
<footer class="footer">
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
