<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Logging and Log Aggregation Architecture :: Stackable Documentation</title>
    <meta name="generator" content="Antora 3.1.0">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../_'</script>
    <link rel="icon" href="../../../../_/img/favicon.png" type="image/png">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://stackable.tech"><img src="../../../../_/img/stackable-logo.png"></a>
      <a class="navbar-item documentation-link" href="https://docs.stackable.tech">Documentation</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search...">
        </div>
      </div>
      <button class="navbar-burger" data-target="navbar-sub">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <a href="https://www.stackable.tech/contact/" class="button pull-right">Contact Us</a>
    </div>
      <div id="topbar-nav" class="navbar-menu">
      </div>
      </div>
    </nav>
    <nav id="navbar-sub" class="navbar-sub">
      <div class="container">
        <a class="navbar-sub-item" href="../../../stable/index.html">Home</a>
<a class="navbar-sub-item" href="../../../stable/getting_started.html">Getting Started</a>
<a class="navbar-sub-item" href="../../../stable/concepts/index.html">Concepts</a>
<a class="navbar-sub-item" href="../../../stable/tutorials/end-to-end_data_pipeline_example.html">Tutorials</a>
<a class="navbar-sub-item" href="../../../../stackablectl/stable/index.html">stackablectl</a>
<div class="navbar-sub-item drop-down">
    Operators
    <div class="drop-down-content">
        <a class="drop-down-item" href="../../../stable/operators/index.html">Overview</a>
        <a class="drop-down-item" href="../../../../airflow/stable/index.html">Apache Airflow</a>
        <a class="drop-down-item" href="../../../../druid/stable/index.html">Apache Druid</a>
        <a class="drop-down-item" href="../../../../hbase/stable/index.html">Apache HBase</a>
        <a class="drop-down-item" href="../../../../hdfs/stable/index.html">Apache Hadoop HDFS</a>
        <a class="drop-down-item" href="../../../../hive/stable/index.html">Apache Hive</a>
        <a class="drop-down-item" href="../../../../kafka/stable/index.html">Apache Kafka</a>
        <a class="drop-down-item" href="../../../../nifi/stable/index.html">Apache NiFi</a>
        <a class="drop-down-item" href="../../../../spark-k8s/stable/index.html">Apache Spark on K8S</a>
        <a class="drop-down-item" href="../../../../superset/stable/index.html">Apache Superset</a>
        <a class="drop-down-item" href="../../../../trino/stable/index.html">Trino</a>
        <a class="drop-down-item" href="../../../../zookeeper/stable/index.html">Apache ZooKeeper</a>
        <a class="drop-down-item" href="../../../../opa/stable/index.html">OpenPolicyAgent</a>
        <a class="drop-down-item" href="../../../../commons-operator/stable/index.html">Commons</a>
        <a class="drop-down-item" href="../../../../secret-operator/stable/index.html">Secret</a>
        <a class="drop-down-item" href="../../../../listener-operator/stable/index.html">Listener</a>
    </div>
</div>
<a class="navbar-sub-item" href="../../../stable/contributor/index.html">Contribute</a>

        <a class="arrow" href="javascript:document.querySelector('.navbar-sub').classList.toggle('open')">
          <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"></path></svg>
        </a>
      </div>
    </nav>
  </header>
<div class="body">
    <div class="container">
<div class="nav-container" data-component="home" data-version="nightly">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <div class="title-wrapper">
      <h3 class="title"><a href="../../index.html">Stackable Documentation</a></h3>
      <div class="page-versions">
        <button class="version-menu-toggle" title="Show other versions of page">nightly</button>
        <div class="version-menu">
          <a class="version is-current" href="ADRXYZ_logging_architecture.html">nightly</a>
          <a class="version is-missing" href="../../../stable/index.html">22.09</a>
          <a class="version is-missing" href="../../../22.06/index.html">22.06</a>
        </div>
      </div>
    </div>
    <ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../quickstart.html">Quickstart</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../getting_started.html">Getting Started</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../concepts/index.html">Concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../concepts/roles-and-role-groups.html">Roles and role groups</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../concepts/service_discovery.html">Service discovery ConfigMap</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../concepts/opa.html">OPA authorization</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../concepts/s3.html">S3 resources</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../concepts/pvc.html">PersistentVolumeClaim usage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../concepts/resources.html">Resource management</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../tutorials/index.html">Tutorials</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../tutorials/end-to-end_data_pipeline_example.html">Setting up an end-to-end data pipeline</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../reference/index.html">Reference</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../reference/s3.html">S3 resources</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../operators/index.html">Operators</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../operators/supported_versions.html">Supported Product Versions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../operators/monitoring.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../../airflow/stable/index.html">Apache Airflow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../../druid/stable/index.html">Apache Druid</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../../hbase/stable/index.html">Apache HBase</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../../hdfs/stable/index.html">Apache Hadoop HDFS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../../hive/stable/index.html">Apache Hive</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../../kafka/stable/index.html">Apache Kafka</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../../nifi/stable/index.html">Apache NiFi</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../../spark-k8s/stable/index.html">Apache Spark on K8S</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../../superset/stable/index.html">Apache Superset</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../../trino/stable/index.html">Trino</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../../zookeeper/stable/index.html">Apache ZooKeeper</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../../opa/stable/index.html">OpenPolicyAgent</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../../commons-operator/stable/index.html">Commons</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../../secret-operator/stable/index.html">Secret</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../index.html">Contributor&#8217;s Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../steps.html">Steps to contribute</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development_dashboard.html">Development Dashboard</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../style_guide.html">Documentation style guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Implementation guidelines</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../service_discovery.html">Service discovery implementation guidelines</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../opa_configuration.html">OPA connection implementation guidelines</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Architectural Decision Records</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Current</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR001-choose_project_language.html">ADR001: Use English as Documentation Language</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR002-choose_repository_structure.html">ADR002: Use Multiple Repositories instead of one Large Repository</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR003-choose_review_mechanism.html">ADR003: Use RTC as Review Mechanism for Changes</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR004-choose_agent_programming_language.html">ADR004: Use Rust as programming language for the agent</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR005-systemd_unit_file_location.html">ADR005: Decide on handling and location of systemd unit files</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR007-defined_reuse_of_k8s.html">ADR007: Decide if Kubernetes Components Are to be Reused for Stackable</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR008-decide_reuse_of_operators.html">ADR008: Allow Reuse of Existing Kubernetes Operators</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR009-selector_support.html">ADR009: Assigning Services to Nodes</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR010-command_pattern.html">ADR010: Expressing one-shot commands in a Kubernetes-native way</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR011-directory_structure.html">ADR011: Directory Structure Used by Stackable Components on Managed Hosts</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR012-authn_token_management.html">ADR012: Authentication token management</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR013-supported_kubernetes_versions.html">ADR013: Supported Kubernetes versions</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR014-user_authentication_for_products.html">ADR014: User Authentication for Products</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR015-using_values_from_configmaps.html">ADR015: How Should Operators Use Values from ConfigMaps &amp; Secrets</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR016-definition_of_s3_objects.html">ADR016: Representation of S3 Buckets in CRDs</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR017-tls_authentication.html">ADR017: TLS authentication</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR018-product_image_versioning.html">ADR018: Product Image Versioning</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR019-trino_catalog_definitions.html">ADR019: Trino catalog definitions</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR020-trino_catalog_usage.html">ADR020: Trino catalog usage</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR021-stackablectl_stacks_inital_version.html">ADR021: Initial Version of Stackable Stacks Functionality</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR022-spark-history-server.html">ADR022: Spark history server</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR023-product-image-selection.html">ADR023: Product image selection</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ADR024-out-of-cluster_access.html">ADR024: How to provide stable out-of-cluster access to products</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Deprecated</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="deprecated/ADR006-choose_orchestrator_storage_backend.html">Use xxx as storage backend for the orchestrator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Drafts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="drafts/ADRx-choose_authorization_engine.html">Choose Authorization Engine</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../release_notes.html">Release Notes</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Stackable Documentation</span>
    <span class="version">nightly</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../../commons-operator/stable/index.html">Stackable Commons Operator</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../../commons-operator/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../../commons-operator/stable/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../../../commons-operator/0.3/index.html">0.3</a>
        </li>
        <li class="version">
          <a href="../../../../commons-operator/0.2/index.html">0.2</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../../../stable/index.html">Stackable Documentation</a>
      <ul class="versions">
        <li class="version is-current">
          <a href="../../index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../stable/index.html">22.09</a>
        </li>
        <li class="version">
          <a href="../../../22.06/index.html">22.06</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../listener-operator/stable/index.html">Stackable Listener Operator</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../listener-operator/stable/index.html">nightly</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../airflow/stable/index.html">Stackable Operator for Apache Airflow</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../../airflow/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../../airflow/stable/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../../../airflow/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../../../airflow/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../../../airflow/0.3/index.html">0.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../druid/stable/index.html">Stackable Operator for Apache Druid</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../../druid/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../../druid/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../../../druid/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../../../druid/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../../../druid/0.2/index.html">0.2</a>
        </li>
        <li class="version">
          <a href="../../../../druid/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../hbase/stable/index.html">Stackable Operator for Apache HBase</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../../hbase/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../../hbase/stable/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../../../hbase/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../../../hbase/0.3/index.html">0.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../hdfs/stable/index.html">Stackable Operator for Apache HDFS</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../../hdfs/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../../hdfs/stable/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../../../hdfs/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../../../hdfs/0.4/index.html">0.4</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../hive/stable/index.html">Stackable Operator for Apache Hive</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../../hive/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../../hive/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../../../hive/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../../../hive/0.6/index.html">0.6</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../kafka/stable/index.html">Stackable Operator for Apache Kafka</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../../kafka/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../../kafka/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../../../kafka/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../../../kafka/0.6/index.html">0.6</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../nifi/stable/index.html">Stackable Operator for Apache NiFi</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../../nifi/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../../nifi/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../../../nifi/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../../../nifi/0.6/index.html">0.6</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../spark-k8s/stable/index.html">Stackable Operator for Apache Spark on Kubernetes</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../../spark-k8s/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../../spark-k8s/stable/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../../../spark-k8s/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../../../spark-k8s/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../../../spark-k8s/0.3/index.html">0.3</a>
        </li>
        <li class="version">
          <a href="../../../../spark-k8s/0.2/index.html">0.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../superset/stable/index.html">Stackable Operator for Apache Superset</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../../superset/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../../superset/stable/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../../../superset/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../../../superset/0.5/index.html">0.5</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../zookeeper/stable/index.html">Stackable Operator for Apache ZooKeeper</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../../zookeeper/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../../zookeeper/stable/index.html">0.12</a>
        </li>
        <li class="version">
          <a href="../../../../zookeeper/0.11/index.html">0.11</a>
        </li>
        <li class="version">
          <a href="../../../../zookeeper/0.10/index.html">0.10</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../opa/stable/index.html">Stackable Operator for OPA</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../../opa/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../../opa/stable/index.html">0.11</a>
        </li>
        <li class="version">
          <a href="../../../../opa/0.10/index.html">0.10</a>
        </li>
        <li class="version">
          <a href="../../../../opa/0.9/index.html">0.9</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../trino/stable/index.html">Stackable Operator for Trino</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../../trino/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../../trino/stable/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../../../trino/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../../../trino/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../../../trino/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../../../trino/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../../../trino/0.3/index.html">0.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../secret-operator/stable/index.html">Stackable Secret Operator</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../../secret-operator/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../../secret-operator/stable/index.html">0.5</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../stackablectl/stable/index.html">stackablectl</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../stackablectl/stable/index.html">nightly</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../stable/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Stackable Documentation</a></li>
    <li><a href="ADRXYZ_logging_architecture.html">Logging and Log Aggregation Architecture</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/felix/repos/documentation/modules/contributor/pages/adr/ADRXYZ_logging_architecture.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Logging and Log Aggregation Architecture</h1>
<div id="preamble">
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Status: [draft]</p>
</li>
<li>
<p>Deciders:</p>
<div class="ulist">
<ul>
<li>
<p>Felix Hennig</p>
</li>
<li>
<p>Lars Francke</p>
</li>
<li>
<p>Malte Sander</p>
</li>
<li>
<p>Razvan Mihai</p>
</li>
<li>
<p>Sebastian Bernauer</p>
</li>
<li>
<p>Siegfried Weber</p>
</li>
<li>
<p>Sönke Liebau</p>
</li>
<li>
<p>Teo Klestrup Röijezon</p>
</li>
</ul>
</div>
</li>
<li>
<p>Date: 2022-10-26</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Technical Story: <a href="https://github.com/stackabletech/issues/issues/202" class="bare">https://github.com/stackabletech/issues/issues/202</a>, <a href="https://github.com/stackabletech/issues/issues/261" class="bare">https://github.com/stackabletech/issues/issues/261</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_context_and_problem_statement"><a class="anchor" href="#_context_and_problem_statement"></a>Context and Problem Statement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As a user of the platform, I have poor visibility into what is happening in different components of the platform, as well as how components influence each other, especially the operator and the product clusters it manages.</p>
</div>
<div class="paragraph">
<p>Logs usually give this insight. Currently, every pod logs to stdout with a certain default log format. For log configuration we support setting a custom log configuration file in some products.</p>
</div>
<div class="paragraph">
<p>Logs are <strong>not persisted</strong>, a crashed pod is difficult to investigate. Logs are <strong>not aggregated</strong>, investigating issues that involve multiple pods is difficult. Log <strong>configuration is difficult</strong> or impossible.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_decision_drivers"><a class="anchor" href="#_decision_drivers"></a>Decision Drivers</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>identical configuration</strong> - All product logs should be configurable in the same way, no matter their underlying logging framework (log4j, logback, Python logging, etc.). Every product should have a logging section in its CRD.</p>
</li>
<li>
<p><strong>easily configured sinks</strong> - A log sink (i.e. elasticsearch) should only be configured in a single place for the whole platform (not in every product instance).</p>
</li>
<li>
<p><strong>Support plaintext logs on stdout</strong> - It is a Kubernetes convention to log in plaintext to stdout. This should be kept, as it is a useful tool for interactive debugging.</p>
</li>
<li>
<p><strong>custom overrides</strong> - The log format, aggregator and sink should be substitutable by the user.</p>
</li>
<li>
<p><strong>transport security</strong> - Logs should transmitted with encryption/TLS.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_assumptions"><a class="anchor" href="#_assumptions"></a>Assumptions</h3>
<div class="ulist">
<ul>
<li>
<p><strong>RegEx parsing is error prone</strong> - Parsing pure string log output to get structure (time, module, log level, message, &#8230;&#8203;) is prone to errors. Especially for multi-line messages like stacktraces. The design should use structured log ouput whenever possible.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_constraints"><a class="anchor" href="#_constraints"></a>Constraints</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Multiple files</strong> - Some products like HDFS <em>need</em> to log to (multiple) files, so parsing just stdout is not sufficient; we need to parse files.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_decision"><a class="anchor" href="#_decision"></a>Decision</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We decided to use <a href="https://vector.dev/">Vector</a> as an aggregator. It looked good, no other options were evaluated.</p>
</div>
<div class="paragraph">
<p>We chose to provide <strong>plaintext logs on stdout</strong> and <strong>structured logs on file</strong>. For the architecture, we chose to deploy the agent as a <strong>sidecar</strong> and <strong>use an aggregator</strong>. We chose to provide <strong>OpenSearch</strong> as a default Sink for logs.</p>
</div>
<div class="paragraph">
<p>Find detailed considerations below.</p>
</div>
<div class="sect2">
<h3 id="_log_aggregation_framework_vector"><a class="anchor" href="#_log_aggregation_framework_vector"></a>Log Aggregation Framework: Vector</h3>
<div class="paragraph">
<p><a href="https://vector.dev/">Vector</a> has been picked without comparison to other existing choices. Some googling shows <a href="https://medium.com/ibm-cloud/log-collectors-performance-benchmarking-8c5218a08fea">Vector has better performance than fluentd</a>, the biggest name in this space. Vector is also open source and written in Rust: <a href="https://github.com/vectordotdev/vector">GitHub</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_log_retrieval_strategy"><a class="anchor" href="#_log_retrieval_strategy"></a>Log Retrieval Strategy</h3>
<div class="paragraph">
<p>We want to parse logs out of structured log entries and also keep the stdout log as plaintext. Also, some products require reading log files instead of stdout. Which means <strong>we opt to read logs from files for every product</strong> and <strong>parse structured log entries</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="log_aggregation_architecture"><a class="anchor" href="#log_aggregation_architecture"></a>Log Aggregation Architecture</h3>
<div class="paragraph">
<p><strong>Agent role</strong> - Vector offers multiple <a href="https://vector.dev/docs/setup/deployment/roles/#agent">roles</a> in which it can run. The DaemonSet is easier to deploy, and only one vector instance is running per host. But the sidecar has deeper integration with the product container and can read log files, something that we decided we need.</p>
</div>
<div class="paragraph">
<p><strong>Topology</strong> - Vector offers multiple <a href="https://vector.dev/docs/setup/deployment/topologies/">topologies</a> and already lists pros and cons. An aggregator makes it easier to configure a sink: only one place to configure it (the aggregator has "multi-host context" as Vector calls it). It also reduces requests made to the sink, as it aggregates and buffers requests.</p>
</div>
<div class="paragraph">
<p>The connection from the agent to the aggregator is made with the help of a <strong>discovery ConfigMap</strong>. The aggregator is discoverable with a discovery ConfigMap, which is referenced in the ProductCluster with a property called <code>vectorAggregatorConfigMapName</code>, similar to <code>zookeeperConfigMapName</code> or <code>hdfsConfigMapName</code>. The property is located at the top level of the spec.</p>
</div>
</div>
<div class="sect2">
<h3 id="_log_sink_opensearch"><a class="anchor" href="#_log_sink_opensearch"></a>Log Sink: OpenSearch</h3>
<div class="paragraph">
<p><a href="https://opensearch.org/">OpenSearch</a> has been picked as the sink for all the aggregated logs. No other options have been considered, but as the sink sits at the very top of the chain, it is easy to swap it out for a different software.</p>
</div>
<div class="paragraph">
<p>The sink is configured in the Vector aggregator. We initially do not provide any "Stackable way" of configuring the sink, but it is easily configured by the user in a single location for the whole platform. Other sinks can be configured easily as well (<a href="https://vector.dev/docs/reference/configuration/sinks/">Vector docs for sink configuration</a>). See also <a href="#deploying_the_stack">Deploying the Stack</a>.</p>
</div>
<div class="paragraph">
<p><strong>For now, setting up the aggregator and sink is the responsibility of the user</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_logging_configuration"><a class="anchor" href="#_logging_configuration"></a>Logging configuration</h3>
<div class="paragraph">
<p><strong>Log levels</strong> - The following log levels are supported: ERROR, WARN, INFO, DEBUG, and TRACE. We support them across all products. The <strong>default log level</strong> is INFO. Products might have slightly different log levels, which are mapped accordingly by the agent. For instance, Superset emits logs with the levels CRITICAL, ERROR, WARNING, INFO, and DEBUG. The mapping should be:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Superset log level</th>
<th class="tableblock halign-left valign-top">Stackable log level</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CRITICAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERROR</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERROR</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARNING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INFO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DEBUG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DEBUG</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DEBUG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRACE</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There is no TRACE log level in Superset, so if the user sets the desired log level to TRACE then it is actually set to DEBUG in Superset.</p>
</div>
<div class="paragraph">
<p><strong>console vs. file</strong> - We want to have different log levels (and possibly other settings) for console (stdout) and file output. This makes debugging easier, without also filling up the log aggregator with very chatty logs.</p>
</div>
<div class="paragraph">
<p><strong>Settings per logger</strong> - Most products (especially Java based ones) support setting a log level per package. We also want to support this in our CRD.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">logging:
  file:
    loggers:
      ROOT:
        level: INFO
      some.interesting.module:
        level: DEBUG
  console:
    loggers:
      ROOT:
        level: DEBUG
      my.specific.package:
        level: TRACE
      my.other.package:
        level: TRACE</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Settings per role</strong> - All of these should be configurable per role and role group. Some sub-loggers are only available in certain roles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">spec:
  someRole:
    config:
      logging:
        ...
    roleGroups:
      default:
        logging:
          ...
      aDifferentGroup:
        logging:
          ...</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Override everything</strong> - The customer should be able to supply their own configuration file. Where this is placed depends on the product.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">logging:
  custom:
    configMap: nameOfMyConfigMapWithTheConfigFile</code></pre>
</div>
</div>
<div class="paragraph">
<p>Like the other logging settings, this costum configuration file can be supplied per role and/or role-group.</p>
</div>
<div class="paragraph">
<p>Setting the <code>custom</code> field will disable any configurations made in <code>file</code> and <code>console</code>. (TODO maybe we can disallow this alltogether in the CRD type)</p>
</div>
<div class="paragraph">
<p><strong>Disable vector</strong> - Vector should be optional, if the user wants to use their own logging system.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">logging:
  enableVectorAgent: false  # defaults to true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploying_the_stack"><a class="anchor" href="#deploying_the_stack"></a>Deploying the Stack</h3>
<div class="paragraph">
<p>The operator deploys the Vector agent as a sidecar and deploys the logging configuration for the product.</p>
</div>
<div class="paragraph">
<p>The aggregator and OpenSearch sink are deployed with a stackablectl Stack for now. The Stack also supports deploying the <a href="#log_aggregation_architecture">aggregator ConfigMap</a>. A more integrated way of deployment and configuration of the aggregator and sink is still to be defined, see <a href="#future_work">Future work that will become necessary</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_consequences"><a class="anchor" href="#_consequences"></a>Consequences</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_positive"><a class="anchor" href="#_positive"></a>Positive</h3>
<div class="paragraph">
<p>Logs across the platform (from products and operators) are <strong>persisted</strong> and <strong>aggregated</strong> in a central location. Crashed pods can be investigated, as well as issues involving multiple products.</p>
</div>
</div>
<div class="sect2">
<h3 id="_negative"><a class="anchor" href="#_negative"></a>Negative</h3>
<div class="ulist">
<ul>
<li>
<p>Every pod will contain a vector sidecar container, which adds overhead.</p>
</li>
<li>
<p>The unified logging configuration hides product specific logging settings.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Changing a log level might lead to a pod getting restarted.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="future_work"><a class="anchor" href="#future_work"></a>Future work that will become necessary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will have to better integrate the deployment of the Vector aggregator and the OpenSearch sink into Stackable.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_links"><a class="anchor" href="#_links"></a>Links</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://vector.dev/">Vector</a></p>
</li>
<li>
<p><a href="https://vector.dev/docs/setup/deployment/roles/">Vector Deployment Roles</a></p>
</li>
<li>
<p><a href="https://vector.dev/docs/setup/deployment/topologies/">Vector Deployment Topologies</a></p>
</li>
</ul>
</div>
</div>
</div>
</article>
  </div>
</main>
    </div>
</div>
<footer class="footer">
</footer>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
  </body>
</html>
